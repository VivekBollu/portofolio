(function(g){var window=this;'use strict';var Iz6=function(r){var V=new g.NO("und",new g.Cp("Default","und",!0));V.captionTracks=r.captionTracks;return V},dl9=function(r){return new g.R0(function(V,I){var d=r.length,a=[];
if(d)for(var f=function(x,E){d--;a[x]=E;d==0&&V(a)},e=function(x){I(x)},n,D=0;D<r.length;D++)n=r[D],g.uni(n,g.ep(f,D),e);
else V(a)})},XZ=function(r){this.G=r},BO=function(){XZ.apply(this,arguments)},azG=function(){BO.apply(this,arguments)},fzG=function(){BO.apply(this,arguments)},eEm=function(){BO.apply(this,arguments)},Yap=function(){BO.apply(this,arguments)},nIp=function(){BO.apply(this,arguments)},juK=function(){BO.apply(this,arguments)},Dlp=function(){XZ.apply(this,arguments)},xlY=function(){BO.apply(this,arguments)},EI_=function(){BO.apply(this,arguments)},Nwc=function(){BO.apply(this,arguments)},suG=function(){BO.apply(this,
arguments)},cm6=function(){BO.apply(this,arguments)},zE6=function(){BO.apply(this,arguments)},MDc=function(){BO.apply(this,arguments)},Ck$=function(){BO.apply(this,arguments)},Twm=function(){BO.apply(this,arguments)},HQ_=function(){BO.apply(this,arguments)},wY9=function(){BO.apply(this,arguments)},bQm=function(){BO.apply(this,arguments)},OQG=function(){XZ.apply(this,arguments)},W0m=function(){BO.apply(this,arguments)},$lc=function(){BO.apply(this,arguments)},K0P=function(){BO.apply(this,arguments)},
REo=function(){BO.apply(this,arguments)},tDY=function(){BO.apply(this,arguments)},ymm=function(){BO.apply(this,arguments)},AmG=function(){BO.apply(this,arguments)},GoY=function(){BO.apply(this,arguments)},F0Y=function(){BO.apply(this,arguments)},lz6=function(){XZ.apply(this,arguments)},L0o=function(){XZ.apply(this,arguments)},Jm$=function(){XZ.apply(this,arguments)},ZQG=function(){BO.apply(this,arguments)},XYe=function(){BO.apply(this,arguments)},BwG=function(){BO.apply(this,arguments)},gIf=function(){BO.apply(this,
arguments)},SaY=function(){BO.apply(this,arguments)},iQf=function(){BO.apply(this,arguments)},UlG=function(){BO.apply(this,arguments)},Quc=function(){BO.apply(this,arguments)},mlm=function(){BO.apply(this,arguments)},upf=function(){BO.apply(this,arguments)},pY9=function(){BO.apply(this,arguments)},vI6=function(){BO.apply(this,arguments)},qap=function(){BO.apply(this,arguments)},PkG=function(){BO.apply(this,arguments)},oI$=function(){BO.apply(this,arguments)},koP=function(){BO.apply(this,arguments)},
hEK=function(){BO.apply(this,arguments)},r_c=function(){BO.apply(this,arguments)},VsG=function(){BO.apply(this,arguments)},Ii6=function(){BO.apply(this,arguments)},d4e=function(){BO.apply(this,arguments)},aiY=function(){BO.apply(this,arguments)},fi$=function(){BO.apply(this,arguments)},eqm=function(){BO.apply(this,arguments)},YnY=function(){BO.apply(this,arguments)},niG=function(){BO.apply(this,arguments)},j0$=function(){XZ.apply(this,arguments)},D4o=function(){BO.apply(this,arguments)},x4c=function(){BO.apply(this,
arguments)},Ei9=function(){BO.apply(this,arguments)},NSY=function(){BO.apply(this,arguments)},s0P=function(){BO.apply(this,arguments)},c_9=function(){BO.apply(this,arguments)},zq_=function(){BO.apply(this,arguments)},MsG=function(){BO.apply(this,arguments)},Coo=function(){BO.apply(this,arguments)},TS_=function(){BO.apply(this,arguments)},HRP=function(){BO.apply(this,arguments)},wu$=function(){BO.apply(this,arguments)},bR_=function(){BO.apply(this,arguments)},ORp=function(){BO.apply(this,arguments)},
Wxe=function(){BO.apply(this,arguments)},$4m=function(){BO.apply(this,arguments)},Kxp=function(){BO.apply(this,arguments)},Rqf=function(){BO.apply(this,arguments)},tsY=function(){BO.apply(this,arguments)},y_P=function(){BO.apply(this,arguments)},A_P=function(){BO.apply(this,arguments)},GO6=function(){BO.apply(this,arguments)},Fxm=function(){BO.apply(this,arguments)},li9=function(){BO.apply(this,arguments)},Lxm=function(){BO.apply(this,arguments)},J_f=function(){BO.apply(this,arguments)},ZR$=function(){BO.apply(this,
arguments)},Xuc=function(){BO.apply(this,arguments)},BSm=function(){BO.apply(this,arguments)},giG=function(){BO.apply(this,arguments)},Snc=function(){BO.apply(this,arguments)},iR9=function(){BO.apply(this,arguments)},U4$=function(r){r=r.key||r.id;
if(!r)throw Error("Entity key is missing");return r},Q0K=function(){if(gp)return gp();
var r={};gp=g.a1("PersistentEntityStoreDb",{IZ:(r.EntityStore={LS:1},r.EntityAssociationStore={LS:2},r),shared:!1,upgrade:function(V,I){I(1)&&g.gC(g.lO(V,"EntityStore",{keyPath:"key"}),"entityType","entityType");I(2)&&(V=g.lO(V,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.gC(V,"byParentEntityKey","parentEntityKey"),g.gC(V,"byChildEntityKey","childEntityKey"))},
version:3});return gp()},m49=function(r){return g.vQ(Q0K(),r)},usK=function(r){return g.vQ((0,g.AgG)(),r)},SV=function(r){this.token=r},iu=function(r,V){V=V===void 0?{}:V;
g.ox.call(this,g.GIG[r],Object.assign({},{name:"PESEncoderError",type:r},V));this.type=r;this.level="WARNING";Object.setPrototypeOf(this,iu.prototype)},puc=function(r){return new iu("WRONG_DATA_TYPE",{Gk:r})},viP=function(r){return r instanceof Error?new iu("UNKNOWN_ENCODE_ERROR",{originalMessage:r.message}):new iu("UNKNOWN_ENCODE_ERROR")},qno=function(r){return r instanceof Error?new iu("UNKNOWN_DECODE_ERROR",{originalMessage:r.message}):new iu("UNKNOWN_DECODE_ERROR")},Poe=function(r,V){r=r instanceof
iu?r:V(r);
g.BG(r);throw r;},oi$=function(){},kOm=function(r,V,I){try{return r.S(V,I)}catch(d){Poe(d,viP)}},hqe=function(r){r=(new TextEncoder).encode(r).subarray(0,16);
var V=new Uint8Array(16);V.set(r);return V},UE=function(r){this.G=r},Vcm=function(r){var V=r5$[r];
if(V)return V;g.gj(new g.ox("Entity model not found.",{entityType:r}))},I3P=function(r,V){this.G=r;
this.X=V;this.S={}},a3_=function(r,V){a:{r=dFc(r.X,V.version);
try{var I=r.X(V.data,V.key);break a}catch(d){Poe(d,qno)}I=void 0}return I},Qp=function(r,V,I){return r.G.objectStore("EntityStore").get(V).then(function(d){if(d){if(I&&d.entityType!==I)throw Error("Incorrect entity type");
return a3_(r,d)}})},m9=function(r,V,I){return I?(I=I.map(function(d){return Qp(r,d,V)}),g.t1.all(I)):r.G.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(V)).then(function(d){return d.map(function(a){return a3_(r,a)})})},pu=function(r,V,I){var d=U4$(V),a=dFc(r.X,1),f=Object.assign({},V);
return r.G.objectStore("EntityStore").get(d).then(function(e){if(e){if(e.entityType!==I)throw Error("Incorrect entity type");f.entityMetadata||(e=a3_(r,e),f.entityMetadata=e.entityMetadata)}}).then(function(){var e={key:d,
entityType:I,data:kOm(a,f,d),version:1};return g.t1.all([g.ZO(r.G.objectStore("EntityStore"),e),f3_(r,f,I)])}).then(function(){uu(r,d,I);
return d})},ePm=function(r,V,I){V=V.map(function(d){return pu(r,d,I)});
return g.t1.all(V)},vO=function(r,V,I){if(I==null?0:I.uq){var d=new Set;
return Yd_(r,V,d).then(function(){for(var f=[],e=g.H(d),n=e.next();!n.done;n=e.next())f.push(vO(r,n.value));return g.t1.all(f).then(function(){})})}var a=g.VG(V).entityType;
return g.t1.all([r.G.objectStore("EntityStore").delete(V),n0$(r,V)]).then(function(){uu(r,V,a)})},jhY=function(r,V){return g.Qs(r.G.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(V)},function(I){return g.t1.all([I.delete(),
n0$(r,I.cursor.primaryKey)]).then(function(){uu(r,I.cursor.primaryKey,V);return g.iO(I)})})},DF$=function(r,V,I,d){var a=dFc(r.X,1);
return Qp(r,V,d).then(function(f){if(f){f=g.wH(f,I);var e={key:V,entityType:d,data:kOm(a,f,V),version:1};return g.t1.all([g.ZO(r.G.objectStore("EntityStore"),e),f3_(r,f,d)])}}).then(function(){uu(r,V,d);
return V})},uu=function(r,V,I){var d=r.S[I];
d||(d=new Set,r.S[I]=d);d.add(V)},xF$=function(r,V,I){var d=U4$(V);
I=Vcm(I);if(!I)return g.t1.resolve([]);I=new I(V);r=r.G.objectStore("EntityAssociationStore");V=[];I=g.H(I.X());for(var a=I.next();!a.done;a=I.next())V.push(g.ZO(r,{parentEntityKey:d,childEntityKey:a.value}));return g.t1.all(V).then(function(f){return f.map(function(e){return e[1]})})},n0$=function(r,V){return r.G.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(V))},f3_=function(r,V,I){var d=U4$(V);
return n0$(r,d).then(function(){return xF$(r,V,I)})},Yd_=function(r,V,I){if(I.has(V))return g.t1.resolve(void 0);
I.add(V);return E0e(r,V).then(function(d){return r.G.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(V)).then(function(){return d})}).then(function(d){var a=g.t1.resolve(void 0);
d=g.H(d);for(var f=d.next(),e={};!f.done;e={zb:void 0},f=d.next())e.zb=f.value,a=a.then(function(n){return function(){return Yd_(r,n.zb,I)}}(e));
return a}).then(function(){})},E0e=function(r,V){var I=r.G.objectStore("EntityAssociationStore");
return I.index("byParentEntityKey").getAll(IDBKeyRange.only(V)).then(function(d){var a=[];d=g.H(d);for(var f=d.next();!f.done;f=d.next())f=f.value,a.push(I.index("byChildEntityKey").getAll(f.childEntityKey));return g.t1.all(a)}).then(function(d){var a=[];
d=g.H(d);for(var f=d.next();!f.done;f=d.next())f=f.value,f.length===1&&a.push(f[0].childEntityKey);return a})},qV=function(){},NYf=function(){this.G={};
this.G[0]=new qV;if(!g.WR("aes_pes_encoder_killswitch")){var r=this.G;try{var V=g.km();var I=hqe(V);var d=new UE(new g.Rd(I),new g.KX(I))}catch(a){throw r=a instanceof Error?new iu("KEY_CREATION_FAILED",{originalMessage:a.message}):new iu("KEY_CREATION_FAILED"),g.BG(r),r;}r[1]=d}},dFc=function(r,V){V=V===void 0?0:V;
r=r.G[V];if(!r)throw V=new iu("INVALID_ENCODER_VERSION",{Gk:V}),g.BG(V),V;return r},PO=function(r,V){g.X.call(this);
this.token=r;this.G=V;this.observers=[];r=new g.vr.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.km());r.onmessage=this.X.bind(this);this.channel=r},ol=function(r,V,I){var d,a,f,e;
return g.L(function(n){if(n.X==1)return g.G(n,m49(r.token),2);if(n.X!=3)return d=n.G,g.G(n,g.J1(d,["EntityStore","EntityAssociationStore"],V,function(D){a=new I3P(D,r.G);return I(a)}),3);
f=n.G;a&&(e=a.S,Object.keys(e).length>0&&(r.channel.postMessage(e),sh9(r,e)));return n.return(f)})},k3=function(r,V,I){return ol(r,{mode:"readwrite",
Wp:!0},function(d){return pu(d,V,I)})},c59=function(r,V){return ol(r,{mode:"readwrite",
Wp:!0},function(I){return ePm(I,V,"offlineOrchestrationActionWrapperEntity")})},zPp=function(r,V){return ol(r,{mode:"readwrite",
Wp:!0},function(I){return vO(I,V)})},McG=function(r){return ol(r,{mode:"readwrite",
Wp:!0},function(V){return jhY(V,"videoPlaybackPositionEntity")})},hN=function(r,V,I){return ol(r,{mode:"readonly",
Wp:!0},function(d){return Qp(d,V,I)})},r0=function(r,V,I){return ol(r,{mode:"readonly",
Wp:!0},function(d){return m9(d,V,I)})},sh9=function(r,V){r=g.H(r.observers);
for(var I=r.next();!I.done;I=r.next())I=I.value,I(V)},Cap=function(){var r,V,I;
return g.L(function(d){if(d.X==1)return g.wA(d,2),g.G(d,g.I1(),4);if(d.X!=2){r=d.G;if(!r||!g.hZ()||typeof g.vr.BroadcastChannel==="undefined")return d.return();V=new NYf;return d.return(new PO(r,V))}I=g.th(d);I instanceof Error&&g.BG(I);return d.return()})},V$=function(){TYo||(TYo=Cap());
return TYo},HbK=function(r){var V;
r=(V=r.options)==null?void 0:V.persistenceOption;return r==="ENTITY_PERSISTENCE_OPTION_PERSIST"||r==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},wAm=function(r){var V;
return g.L(function(I){return I.X==1?g.G(I,V$(),2):(V=I.G)?g.G(I,ol(V,"readwrite",function(d){for(var a={},f=g.H(r),e=f.next(),n={};!e.done;n={ih:void 0,KO:void 0},e=f.next())n.ih=e.value,n.ih.entityKey&&HbK(n.ih)&&(n.KO=g.u$(n.ih.payload),e=void 0,n.ih.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(e=function(D){return function(){return pu(d,D.ih.payload[D.KO],D.KO)}}(n)),n.ih.type==="ENTITY_MUTATION_TYPE_DELETE"&&(e=function(D){return function(){return vO(d,D.ih.entityKey)}}(n)),n.ih.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(e=function(D){return function(){return DF$(d,D.ih.entityKey,D.ih.payload[D.KO],D.KO)}}(n)),e&&(a[n.ih.entityKey]=a[n.ih.entityKey]?a[n.ih.entityKey].then(e):e()));
return g.t1.all(Object.values(a))}),0):I.return()})},bb9=function(r){var V;
return g.L(function(I){if(I.X==1){V=r.mutations;if(!V||V.length<=0)return I.return();if(g.e3){var d={type:"ENTITY_LOADED"};V!==void 0&&(d.payload=V);g.e3.dispatch(d)}return g.G(I,wAm(V),2)}V.length=0;g.Hr(I)})},Obm=function(r){return r!==void 0},WSG=function(r){var V=g.lL();
V=Object.assign({},V);r=Object.assign({},r);for(var I in V)r[I]?(V[I]!==4&&(V[I]=r[I]),delete r[I]):V[I]!==2&&(V[I]=4);Object.assign(V,r);g.aFS(V);JSON.stringify(V);return V},$Ff=function(r){var V,I;
return g.L(function(d){if(d.X==1)return g.G(d,g.I1(),2);if(d.X!=3)return(V=d.G)?g.G(d,g.Zb(V),3):d.return();I=d.G;return d.return(g.J1(I,["index","media","captions"],{mode:"readwrite",Wp:!0},function(a){var f=IDBKeyRange.bound(r+"|",r+"~");a=[a.objectStore("index").delete(f),a.objectStore("media").delete(f),a.objectStore("captions").delete(f)];return g.t1.all(a).then(function(){})}))})},KSm=function(){var r,V;
return g.L(function(I){if(I.X==1)return g.G(I,g.I1(),2);if(I.X!=3){r=I.G;if(!r)throw g.KH("rvdfd");return g.G(I,g.Zb(r),3)}V=I.G;return I.return(g.J1(V,["index","media"],{mode:"readwrite",Wp:!0},function(d){var a={};return g.ST(d.objectStore("index"),{},function(f){var e=f.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),n=g.t1.resolve(void 0);if(e){var D=e[1];e=e[2];a[D]=a[D]||{};var x;a[D][e]=g.jTA((x=f.getValue())==null?void 0:x.fmts)}else n=f.delete().then(function(){});
return g.t1.all([g.iO(f),n]).then(function(E){return g.H(E).next().value})}).then(function(){for(var f={},e=g.H(Object.keys(a)),n=e.next();!n.done;n=e.next()){n=n.value;
var D=a[n].v;f[n]=a[n].a&&D?1:2}var x=WSG(f);return g.RGi(d.objectStore("media"),{},function(E){var N=E.cursor.key.match(g.NIZ);N&&f[N[1]]||d.objectStore("media").delete(E.cursor.key);return g.CFr(E)}).then(function(){return x})})}))})},RPo=function(r,V){var I,d;
return g.L(function(a){if(a.X==1)return g.G(a,g.I1(),2);if(a.X!=3){I=a.G;if(!I)throw g.KH("wct");return g.G(a,g.Zb(I),3)}d=a.G;return g.G(a,g.J1(d,["captions"],{mode:"readwrite",Wp:!0},function(f){var e=[];f=f.objectStore("captions");for(var n=0;n<V.length;n++){var D=g.ZO(f,V[n],r+"|"+V[n].metadata.vss_id);e.push(D)}return g.t1.all(e)}),0)})},tco=function(r){var V,I,d;
return g.L(function(a){if(a.X==1)return V=IDBKeyRange.bound(r+"|",r+"~"),g.G(a,g.I1(),2);if(a.X!=3){I=a.G;if(!I)throw g.KH("gactfv");return g.G(a,g.Zb(I),3)}d=a.G;return a.return(d.getAll("captions",V))})},y5G=function(r){return g.L(function(V){g.JI(r,0);
return V.return($Ff(r))})},A5$=function(r){return{context:g.V2(),
videoIds:r}},G3G=function(r){return{context:g.V2(),
playlistIds:r}},FSf=function(r){return{context:g.V2(),
offlinePlaylistSyncChecks:r}},l3f=function(){this.G=new Map},J56=function(){LSm||(LSm=new l3f);
return LSm},Zbe=function(r,V){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:r},metadata:V,statusCode:void 0,csn:void 0,can:void 0}},XAY=function(r,V,I){if(!I){var d=d===void 0?!1:d;
I=r.G.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!I||d)I=g.RM(16),r.G.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",I)}r={flowNonce:I,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:V.eventType};V.metadata&&(r.flowMetadata=V.metadata);V.statusCode!==void 0&&(r.flowEventStatus=V.statusCode);V.csn&&(r.csn=V.csn);V.can&&(r.can=V.can);g.N9("flowEvent",r,void 0)},BYm=function(r){var V,I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp,yZ,Kg,fG,O,ng,qm,Wt;
return g.L(function(Ao){if(Ao.X==1)return g.G(Ao,ol(r,{mode:"readonly",Wp:!0},function(c9){return m9(c9,"playbackData").then(function(Br){var Jo=Br.map(function(A){return A.transfer}).filter(function(A){return!!A}),G6=Br.map(function(A){return A.offlineVideoPolicy}).filter(function(A){return!!A}),t=Br.filter(function(A){return!!A.key}).map(function(A){return g.Id(g.VG(A.key).entityId,"downloadStatusEntity")});
Jo=m9(c9,"transfer",Jo);G6=m9(c9,"offlineVideoPolicy",G6);t=m9(c9,"downloadStatusEntity",t);var y=Jo.then(function(A){A=A.reduce(function(Z,Q){(Q==null?0:Q.offlineVideoStreams)&&Z.push.apply(Z,g.R(Q.offlineVideoStreams));return Z},[]).filter(function(Z){return!!Z});
return m9(c9,"offlineVideoStreams",A)});
return g.t1.all([Jo,G6,y,t]).then(function(A){var Z=g.H(A);A=Z.next().value;var Q=Z.next().value;var Wr=Z.next().value;Z=Z.next().value;return[Br,A,Q,Wr,Z]})})}),2);
if(Ao.X!=3)return V=Ao.G,g.G(Ao,ol(r,{mode:"readonly",Wp:!0},function(c9){return m9(c9,"mainDownloadsListEntity").then(function(Br){var Jo,G6;return(G6=(Jo=Br[0])==null?void 0:Jo.downloads)!=null?G6:[]})}),3);
I=Ao.G;d=g.H(V);a=d.next().value;f=d.next().value;e=d.next().value;n=d.next().value;D=d.next().value;x=a;E=f;N=e;c=n;z=D;M={};w={};b={};W={};K={};F=[];l=g.H(E);for(B=l.next();!B.done;B=l.next())(P=B.value)&&(M[P.key]=P);p=g.H(N);for(dA=p.next();!dA.done;dA=p.next())(fg=dA.value)&&(w[fg.key]=fg);rA=g.H(z);for(ji=rA.next();!ji.done;ji=rA.next())(k=ji.value)&&(b[k.key]=k);bX=g.H(c);for(RX=bX.next();!RX.done;RX=bX.next())(Ui=RX.value)&&(W[Ui.key]=Ui);$f=g.H(I);for(jp=$f.next();!jp.done;jp=$f.next())yZ=
jp.value,Kg=void 0,K[(Kg=yZ.videoItem)!=null?Kg:""]=!0,yZ.videoItem&&(O=fG=void 0,ng=(O=(fG=g.VG(yZ.videoItem))==null?void 0:fG.entityId)!=null?O:"",F.push({externalVideoId:ng}));qm=x.filter(function(c9){if(!c9||!c9.key||!c9.offlineVideoPolicy)return!1;c9=g.VG(c9.key).entityId;c9=g.Id(c9,"downloadStatusEntity");var Br;return!(c9&&((Br=b[c9])==null?void 0:Br.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
Wt=qm.map(function(c9){var Br=M[c9.transfer],Jo=[];if(Br==null?0:Br.offlineVideoStreams)for(var G6=g.H(Br.offlineVideoStreams),t=G6.next();!t.done;t=G6.next())(t=W[t.value])&&Jo.push(t);G6=w[c9.offlineVideoPolicy];t=K;var y=c9==null?void 0:c9.playerResponseTimestamp,A=g.VG(G6.key).entityId;c9=g.Id(A,"mainVideoEntity");if(G6.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Z="OFFLINE_VIDEO_STATE_DISABLED";G6.expirationTimestamp&&Number(G6.expirationTimestamp)<Date.now()/1E3&&(Z="OFFLINE_VIDEO_STATE_EXPIRED")}else if(G6.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Z="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Br==null?void 0:Br.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Z="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Z="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Z="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Z="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Z="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Z="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Z="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Z==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Br==null?void 0:Br.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Z="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Z="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Z=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}A={id:A,videoState:Z};if(Br==null?0:Br.cotn)A.cotn=Br.cotn;if(Br==null?0:Br.maximumDownloadQuality)A.selectedVideoQuality=Br==null?void 0:Br.maximumDownloadQuality;if(Br==null?0:Br.lastProgressTimeMs)A.lastProgressTimeMs=Br.lastProgressTimeMs;y&&(A.playerResponseSavedTimeMs=String(Number(y)*1E3));Br=String;y=0;Jo=g.H(Jo);for(Z=Jo.next();!Z.done;Z=Jo.next())if(Z=Z.value,Z.streamsProgress){Z=g.H(Z.streamsProgress);for(var Q=Z.next();!Q.done;Q=Z.next()){var Wr=void 0;
y+=Number((Wr=Q.value.numBytesDownloaded)!=null?Wr:0)}}A.downloadedBytes=Br(y);A.selectedOfflineMode=t[c9]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";G6.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(A.offlinePlaybackDisabledReason=G6.offlinePlaybackDisabledReason);return A});
return Ao.return({offlineVideos:Wt,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:F}}})})},g0e=function(){this.locks=navigator.locks},SdP=function(){try{var r=g.Pr("ytglobal.locks_");
if(r)return r;var V;if(V=navigator){var I=navigator;V="locks"in I&&!!I.locks}if(V)return g.vr.localStorage&&g.vr.localStorage.getItem("noop"),r=new g0e,g.qp("ytglobal.locks_",r),r}catch(d){}},IW=function(){},ibp=function(){},UFe=function(r){if(r.includes(":"))throw Error("Invalid user cache name: "+r);
return r+":"+g.km("CacheStorage get")},Qh_=function(){return g.L(function(r){if(d0!==void 0)return r.return(d0);
d0=new Promise(function(V){var I;return g.L(function(d){switch(d.X){case 1:return g.wA(d,2),g.G(d,aW.open("test-only"),4);case 4:return g.G(d,aW.delete("test-only"),5);case 5:g.$v(d,3);break;case 2:if(I=g.th(d),I instanceof Error&&I.name==="SecurityError")return V(!1),d.return();case 3:V("caches"in window),g.Hr(d)}})});
return r.return(d0)})},u1P=function(){return g.L(function(r){if(r.X==1)return g.G(r,Qh_(),2);
if(!r.G)return r.return(void 0);mFP||(mFP=new ibp);return r.return(mFP)})},f7=function(r,V,I){g.gj(new g.ox("Woffle: "+r,I?{cotn:I}:""));
V instanceof Error&&g.gj(V)},pAG=function(r){var V;
return g.L(function(I){if(I.X==1)return g.G(I,BYm(r),2);V=I.G;g.N9("offlineStateSnapshot",V);g.Hr(I)})},eY=function(r){g.X.call(this);
var V=this;this.api=r;this.m_={LaL:function(){return V.G},
V8M:function(){return V.X}};
typeof g.vr.BroadcastChannel!=="undefined"&&(this.G=new g.vr.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.km()),this.G.onmessage=this.S.bind(this),this.X=new g.vr.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.km()),this.X.onmessage=this.Y.bind(this))},YL=function(r,V){r.api.Bs("onOfflineOperationFailure",V);
var I;(I=r.G)==null||I.postMessage(V)},v0m=function(r,V,I,d){var a=this;
this.j=r;this.V=V;this.visibility=I;this.U=d;this.W=this.L=this.C=this.S=this.G=!1;this.Y=new g.hz(function(){a.cF()});
this.m_={FK:function(){return a.X},
cF:function(){a.cF()},
O9H:function(){return a.Y}};
this.visibility.subscribe("visibilitystatechange",function(){a.r$()})},qdG=function(r){if(!r.S&&!r.G){var V=SdP();
if(V){r.S=!0;var I=g.km("OfflineLockManager");V.request("woffle_orchestration_leader:"+I,{},function(){var d,a,f,e;return g.L(function(n){switch(n.X){case 1:return g.wA(n,2),r.X=new g.cA,r.G=!0,r.S=!1,g.G(n,r.j(),4);case 4:return g.G(n,r.X.promise,5);case 5:g.$v(n,0);break;case 2:d=g.th(n),((f=(a=r).U)==null?0:f.call(a,"wo_relinquish_leadership_on_lock_request_error"))||r.cF(),d instanceof Error&&(e=d,e.args=[{name:"WoLockManagerError",FD:d.name}],g.BG(e)),g.Hr(n)}})})}}},Pa$=function(r){r.G&&(r.W=
!0,n7(r))},o0o=function(r,V){r.G&&(r.C=V,n7(r))},k3P=function(r,V){r.G&&(r.L=V,n7(r))},n7=function(r){r.L&&r.C&&r.W&&r.visibility.isBackground()?g.r3(r.Y,6E4):r.Y.stop()},jY=function(r){var V;
r.offlineDeleteReason=(V=r.offlineDeleteReason)!=null?V:"OFFLINE_DELETE_REASON_UNKNOWN";var I;r.offlineModeType=(I=r.offlineModeType)!=null?I:"OFFLINE_NOW";g.N9("offlineDeleteEvent",r)},Dl=function(r,V){var I=V.videoId;
var d=V.qT;V=V.offlineModeType;r.encryptedVideoId=I;r.cotn=d==null?void 0:d.cotn;r.offlineabilityFormatType=d==null?void 0:d.maximumDownloadQuality;var a;r.isRefresh=(a=d==null?void 0:d.isRefresh)!=null?a:!1;var f;r.softErrorCount=(f=d==null?void 0:d.transferRetryCount)!=null?f:0;r.offlineModeType=V!=null?V:"OFFLINE_NOW";(r.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&r.statusType==="UNKNOWN_STATUS_TYPE"||!r.transferStatusType&&!r.statusType)&&g.gj(Error("Woffle unknown transfer status"));
g.N9("offlineTransferStatusChanged",r)},hPc=function(r){Dl({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},r)},rz_=function(r,V,I,d){d={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!d};V&&I&&(V=Math.floor(V/1024).toFixed(),I=Math.floor(I/1024).toFixed(),d.alreadyDownloadedKbytes=V,d.totalFetchedKbytes=V,d.totalContentKbytes=I);Dl(d,r)},Vk_=function(r){Dl({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},r)},I29=function(r){Dl({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},r)},dcG=function(r){switch(r){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
xL=function(r){var V,I,d;
return((d=(V=r.actionMetadata)==null?void 0:(I=V.retryScheduleIntervalsInSeconds)==null?void 0:I.length)!=null?d:0)>0},E0=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!r.entityKey},NR=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!r.entityKey},s0=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!r.entityKey},a2f=function(r){return r.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!r.entityKey},
cK=function(r,V,I,d,a){a=a===void 0?!1:a;
var f,e,n,D,x,E;return g.L(function(N){if(N.X==1)return f=g.Id(r,V),e=g.Id(r,"downloadStatusEntity"),g.G(N,ol(I,{mode:"readonly",Wp:!0},function(c){return g.t1.all([Qp(c,f,V),Qp(c,e,"downloadStatusEntity")])}),2);
n=N.G;D=n.length?n[0]:void 0;if(!D)return N.qk(0);x=f2c;if(E=n.length>1?n[1]:void 0){if(E.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!a)return N.return();E.downloadState=d}else E={key:e,downloadState:d};g.ms(D,x,E);return g.G(N,ol(I,{mode:"readwrite",Wp:!0},function(c){return g.t1.all([pu(c,D,V),pu(c,E,"downloadStatusEntity")])}),0)})},z8=function(r,V){return r.actionType===V.actionType&&r.entityKey===V.entityKey},MR=function(r,V){if(r&&r.transferState!=="TRANSFER_STATE_COMPLETE"&&r.transferState!==
"TRANSFER_STATE_FAILED"){var I=g.VG(r.key).entityId;
Dl({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:I,qT:r,offlineModeType:V})}},C7=function(r){if(!r||!r.thumbnails)return[];
var V=[];r=g.H(r.thumbnails);for(var I=r.next();!I.done;I=r.next())I=I.value,I.url&&V.push(I.url);return V},e9G=function(r,V,I){I=I===void 0?[]:I;
var d,a,f,e,n,D,x,E,N,c,z,M,w;return g.L(function(b){if(b.X==1)return I.length?g.G(b,r0(r,V),2):b.return([]);d=b.G;a=new Set;f=g.H(d);for(e=f.next();!e.done;e=f.next())if(n=e.value,D=n.id||n.key)x=g.VG(D).entityId,a.add(x);E=[];N=g.H(I);for(c=N.next();!c.done;c=N.next())z=c.value,M=z.offlineVideoData,w=void 0,((w=M)==null?0:w.videoId)&&!a.has(M.videoId)&&E.push(z);return b.return(E)})},YKc=function(r,V,I){return new g.qC(r,{cotn:V,
raw_player_response:I,download_media:!0,start:Infinity,disable_watch_next:!0})},ny_=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},T8=function(r,V,I,d,a,f,e,n,D,x,E){this.entityType=r;
this.actionId=V;this.action=I;this.parentActionId=d;this.rootActionId=a===void 0?V:a;this.childActionIds=f;this.prereqActionId=e;this.postreqActionIds=n;this.hasChildActionFailed=x;this.retryScheduleIndex=0;this.G=E||Date.now();this.retryScheduleIndex=D||0},HK=function(r){if(!r.key)throw Error("Entity key is required.");
if(!r.actionProto)throw Error("OfflineOrchestrationAction is required.");var V=g.VG(r.key),I=g.VG(r.actionProto.entityKey);return new T8(I.entityType,V.entityId,r.actionProto,r.parentActionId,r.rootActionId,r.childActionIds,r.prereqActionId,r.postreqActionIds,r.retryScheduleIndex,r.hasChildActionFailed,Number(r.enqueueTimeSec)*1E3)},w0=function(r){return{key:g.Id(r.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:r.action,parentActionId:r.parentActionId,rootActionId:r.rootActionId,childActionIds:r.childActionIds,prereqActionId:r.prereqActionId,postreqActionIds:r.postreqActionIds,retryScheduleIndex:r.retryScheduleIndex,hasChildActionFailed:r.hasChildActionFailed,enqueueTimeSec:(r.G/1E3).toFixed()}},jNc=function(){var r;
return g.L(function(V){return V.X==1?g.G(V,u1P(),2):(r=V.G)?V.return(r.delete("yt-player-local-img")):V.return(!0)})},bJ=function(r){var V,I;
return g.L(function(d){if(d.X==1)return g.G(d,u1P(),2);if(d.X!=3){V=d.G;if(!V)throw Error("Cache API not supported");return r.length?g.G(d,V.open("yt-player-local-img"),3):d.return()}I=d.G;return g.G(d,Promise.all(r.map(function(a){return I.delete(a)})),0)})},O0=function(r){var V,I;
return g.L(function(d){if(d.X==1)return g.G(d,u1P(),2);if(d.X!=3){V=d.G;if(!V)throw Error("Cache API not supported");return r.length?g.G(d,V.open("yt-player-local-img"),3):d.return()}I=d.G;return g.G(d,I.addAll(r),0)})},WK=function(r,V,I,d,a){var f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp,yZ,Kg;
return g.L(function(fG){switch(fG.X){case 1:return f=g.Id(r,"mainVideoEntity"),e=g.Id(r,"ytMainChannelEntity"),n=g.Id(r,"transfer"),D=g.Id(r,"videoDownloadContextEntity"),g.G(fG,ol(V,{mode:"readonly",Wp:!0},function(O){return g.t1.all([Qp(O,f,"mainVideoEntity"),Qp(O,e,"ytMainChannelEntity"),Qp(O,n,"transfer"),Qp(O,D,"videoDownloadContextEntity"),m9(O,"ytMainChannelEntity"),m9(O,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:x=fG.G;E=g.H(x);N=E.next().value;c=E.next().value;z=E.next().value;M=E.next().value;w=E.next().value;b=E.next().value;W=N;K=c;F=z;l=M;B=w;P=b;if(!W&&!K){fG.qk(3);break}p=W?C7(W.thumbnail):[];if(!K){dA=[];fG.qk(4);break}return g.G(fG,Dcm(K,B),5);case 5:dA=fG.G;case 4:return fg=dA,g.G(fG,bJ(p.concat(fg)),3);case 3:rA=[];ji=g.Id(r,"downloadStatusEntity");k=g.H(P);for(bX=k.next();!bX.done;bX=k.next())RX=bX.value,Ui=g.VG(RX.key).entityId,$f=HK(RX),jp=g.VG($f.action.entityKey).entityId,Ui!==r&&jp!==
r||z8(I,RX.actionProto)||rA.push(RX.key);return g.G(fG,ol(V,{mode:"readwrite",Wp:!0},function(O){var ng=rA.map(function(qm){return vO(O,qm)});
ng.push(vO(O,f,{uq:!0}));ng.push(vO(O,ji,{uq:!0}));return g.t1.all(ng)}),7);
case 7:Kg=(yZ=l)==null?void 0:yZ.offlineModeType,a&&(jY(a),a.offlineModeType&&(Kg=a.offlineModeType)),MR(F,Kg),YL(d,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Hr(fG)}})},NWe=function(r,V,I,d){var a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp,yZ,Kg,fG,O,ng,qm,Wt,Ao,c9,Br,Jo,G6,t,y,A,Z,Q,Wr,IX,Cg;
return g.L(function(aX){switch(aX.X){case 1:return a=g.Id(r,"mainPlaylistEntity"),f=g.Id(r,"ytMainChannelEntity"),g.G(aX,ol(V,{mode:"readonly",Wp:!0},function(GS){return g.t1.all([Qp(GS,a,"mainPlaylistEntity"),Qp(GS,f,"ytMainChannelEntity"),m9(GS,"mainPlaylistEntity"),m9(GS,"mainDownloadsListEntity"),m9(GS,"ytMainChannelEntity"),m9(GS,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:e=aX.G;n=g.H(e);D=n.next().value;x=n.next().value;E=n.next().value;N=n.next().value;c=n.next().value;z=n.next().value;M=D;w=x;b=E;W=N;K=c;F=z;if(!M&&!w){aX.qk(3);break}l=M?xc6(M):[];if(!w){B=[];aX.qk(4);break}return g.G(aX,Dcm(w,K),5);case 5:B=aX.G;case 4:return P=B,g.G(aX,bJ(l.concat(P)),3);case 3:p=[];dA=new Map;if(!M){aX.qk(7);break}return g.G(aX,Eyf(M,b,W),8);case 8:p=aX.G;fg=g.H(p);for(rA=fg.next();!rA.done;rA=fg.next())ji=rA.value,dA.set(ji,{videoId:ji,playlistId:r,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.G(aX,ol(V,{mode:"readonly",Wp:!0},function(GS){return g.t1.all([m9(GS,"transfer"),m9(GS,"videoDownloadContextEntity")])}),9);
case 9:k=aX.G;bX=g.H(k);RX=bX.next().value;Ui=bX.next().value;$f=RX;jp=Ui;yZ=g.H($f);for(Kg=yZ.next();!Kg.done;Kg=yZ.next())fG=Kg.value,O=g.VG(fG.key).entityId,(ng=dA.get(O))&&fG&&(ng.cotn=fG.cotn);qm=g.H(jp);for(Wt=qm.next();!Wt.done;Wt=qm.next())Ao=Wt.value,c9=g.VG(Ao.key).entityId,(Br=dA.get(c9))&&Ao&&(Br.offlineModeType=Ao.offlineModeType);case 7:Jo=[];G6=g.H(F);for(t=G6.next();!t.done;t=G6.next())y=t.value,A=g.VG(y.key).entityId,Z=HK(y),A!==r&&Z.rootActionId!==r||z8(I,y.actionProto)||Jo.push(y.key);
Q=g.Id(r,"mainPlaylistEntity");return g.G(aX,ol(V,{mode:"readwrite",Wp:!0},function(GS){var oX=Jo.map(function(O_){return vO(GS,O_)});
oX.push(vO(GS,Q,{uq:!0}));return g.t1.all(oX)}),10);
case 10:if(!M){aX.qk(0);break}p.reverse();if(!p){aX.qk(0);break}Wr=g.H(p);IX=Wr.next();case 13:if(IX.done){aX.qk(0);break}Cg=IX.value;return g.G(aX,WK(Cg,V,I,d,dA.get(Cg)),14);case 14:IX=Wr.next(),aX.qk(13)}})},cz$=function(r,V,I,d){var a,f,e,n,D,x,E,N,c;
return g.L(function(z){if(z.X==1)return a=g.Id("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),f=new Map,g.G(z,ol(r,{mode:"readwrite",Wp:!0},function(M){var w=m9(M,"transfer"),b=m9(M,"offlineOrchestrationActionWrapperEntity"),W=m9(M,"videoDownloadContextEntity"),K=Qp(M,a,"mainDownloadsListEntity");return g.t1.all([w,b,W,K]).then(function(F){F=g.H(F);var l=F.next().value;var B=F.next().value;var P=F.next().value;var p=F.next().value;F=sN9.map(function(fg){return jhY(M,fg)});
B=g.H(B);for(var dA=B.next();!dA.done;dA=B.next())dA=dA.value,z8(V,dA.actionProto)||F.push(vO(M,dA.key,{uq:!0}));p&&(p.downloads=[],F.push(pu(M,p,"mainDownloadsListEntity")));if(P)for(P=g.H(P),p=P.next();!p.done;p=P.next())p=p.value,B=g.VG(p.key).entityId,B=g.Id(B,"transfer"),f.set(B,p.offlineModeType);return g.t1.all(F).then(function(){return l})})}),2);
e=z.G;n=g.H(e);for(D=n.next();!D.done;D=n.next())x=D.value,MR(x,f.get(x.key)),E=g.VG(x.key).entityId,N={videoId:E,offlineDeleteReason:d,cotn:x.cotn,offlineModeType:f.get(x.key)},jY(N),c=g.Id(E,"mainVideoEntity"),YL(I,{entityKey:c,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.G(z,jNc(),0)})},xc6=function(r,V){var I=[];
if(r.thumbnailStyleData){r=g.H(r.thumbnailStyleData);for(var d=r.next();!d.done;d=r.next()){var a=void 0,f=void 0,e=void 0;I=I.concat(C7((a=d.value)==null?void 0:(f=a.value)==null?void 0:(e=f.collageThumbnail)==null?void 0:e.coverThumbnail))}}V=C7(V);return I.concat(V)},Eyf=function(r,V,I){var d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg;
return g.L(function(rA){d=[];a=new Set;if(I.length)for(f=g.H(I),e=f.next();!e.done;e=f.next())if(n=e.value,D=void 0,(D=n.downloads)==null?0:D.length)for(x=g.H(n.downloads),E=x.next();!E.done;E=x.next())N=E.value,N.videoItem&&(c=g.VG(N.videoItem).entityId,a.add(c));if(r.videos){z=g.H(r.videos);for(M=z.next();!M.done;M=z.next())w=M.value,b=JSON.parse(g.VG(w).entityId),b.videoId&&!a.has(b.videoId)&&d.push(b.videoId);W=g.H(V);for(K=W.next();!K.done;K=W.next())if(F=K.value,F.key!==r.key&&(l=F.videos))for(B=
g.H(l),P=B.next();!P.done;P=B.next())p=P.value,dA=JSON.parse(g.VG(p).entityId),dA.videoId&&(fg=d.indexOf(dA.videoId),fg!==-1&&d.splice(fg,1))}return rA.return(d)})},Dcm=function(r,V){var I,d,a,f,e,n,D,x;
return g.L(function(E){I=C7(r.avatar);d=g.H(V);for(a=d.next();!a.done;a=d.next())if(f=a.value,f.id!==r.id)for(e=g.H(C7(f.avatar)),n=e.next();!n.done;n=e.next())D=n.value,x=I.indexOf(D),x!==-1&&I.splice(x,1);return E.return(I)})},z9e=function(r){var V;
return g.L(function(I){V=g.U(r.frameworkUpdates,$L);return r.frameworkUpdates&&V?g.G(I,bb9(V),0):I.return()})},CP_=function(r){var V;
if((V=r.onResponseReceivedActions)!=null&&V.length){var I;r=(I=g.U(g.U(r.onResponseReceivedActions[0],MkY),g.RfG))==null?void 0:I.actions;if(r!=null&&r.length)return r}},TWf=function(r){var V,I,d;
return g.L(function(a){if(a.X==1)return r?g.G(a,hN(r,g.Jn,"mainDownloadsListEntity"),2):a.return([]);V=a.G;return((I=V)==null?0:(d=I.downloads)==null?0:d.length)?a.return(V.downloads.map(function(f){var e;return(e=f.videoItem)!=null?e:""})):a.return([])})},w4P=function(r,V){var I;
return g.L(function(d){return d.X==1?g.G(d,HmK(r,V),2):(I=d.G)?g.G(d,ol(r,{mode:"readwrite",Wp:!0},function(a){var f=[pu(a,I.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];I.mainDownloadsListEntity&&f.push(pu(a,I.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.t1.all(f)}),0):d.qk(0)})},HmK=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F;
return g.L(function(l){if(l.X==1)return I=g.Id("main_downloads_library_id","mainDownloadsLibraryEntity"),d=g.Id("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.G(l,ol(r,{mode:"readonly",Wp:!0},function(B){return g.t1.all([Qp(B,I,"mainDownloadsLibraryEntity"),Qp(B,d,"mainDownloadsListEntity")])}),2);
a=l.G;f=g.H(a);e=f.next().value;n=f.next().value;D=e;x=n;D||(D={id:I});E=g.H(V);for(N=E.next();!N.done;N=E.next())if(c=N.value,c===g.Jn){if(D.smartDownloadsList)return l.return();D.smartDownloadsList=c}else if(z=g.VG(c).entityType,M={},z==="mainPlaylistEntity"?M.playlistItem=c:z==="mainVideoEntity"&&(M.videoItem=c),!g.ho(M)){w=void 0;if((w=x)==null?0:w.downloads){b=!1;W=g.H(x.downloads);for(K=W.next();!K.done;K=W.next())if(F=K.value,F.playlistItem===c||F.videoItem===c){b=!0;break}b||x.downloads.push(M)}else x=
{id:d,downloads:[M]};D.downloadsList=d}return l.return({mainDownloadsLibraryEntity:D,mainDownloadsListEntity:x})})},bme=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b;
return g.L(function(W){if(W.X==1)return I=g.Id("main_downloads_library_id","mainDownloadsLibraryEntity"),d=g.Id("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.G(W,ol(r,{mode:"readonly",Wp:!0},function(K){return g.t1.all([Qp(K,I,"mainDownloadsLibraryEntity"),Qp(K,d,"mainDownloadsListEntity"),Qp(K,g.Jn,"mainDownloadsListEntity")])}),2);
a=W.G;f=g.H(a);e=f.next().value;n=f.next().value;D=f.next().value;x=e;E=n;N=D;if(!x)return W.qk(0);if(V===g.Jn&&((c=N)==null?0:c.downloads))N.downloads=[];else if((z=E)==null?0:z.downloads)for(M=g.VG(V).entityType,w=0;w<E.downloads.length;w++)if(b=E.downloads[w],M==="mainVideoEntity"&&b.videoItem===V){E.downloads.splice(w,1);break}else if(M==="mainPlaylistEntity"&&b.playlistItem===V){E.downloads.splice(w,1);break}return g.G(W,ol(r,{mode:"readwrite",Wp:!0},function(K){var F=[pu(K,x,"mainDownloadsLibraryEntity")];
E&&F.push(pu(K,E,"mainDownloadsListEntity"));N&&F.push(pu(K,N,"mainDownloadsListEntity"));return g.t1.all(F)}),0)})},K7=function(r,V){var I,d,a,f,e,n,D,x,E,N,c;
return g.L(function(z){if(z.X==1)return I=g.Id(V,"transfer"),d=g.Id(V,"videoDownloadContextEntity"),g.G(z,ol(r,{mode:"readonly",Wp:!0},function(M){return g.t1.all([Qp(M,I,"transfer"),Qp(M,d,"videoDownloadContextEntity")])}),2);
a=z.G;f=g.H(a);e=f.next().value;n=f.next().value;D=e;x=n;c={videoId:V,cotn:(E=D)==null?void 0:E.cotn,offlineModeType:(N=x)==null?void 0:N.offlineModeType};return z.return(c)})},RW=function(r,V,I,d,a){var f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA;
return g.L(function(fg){switch(fg.X){case 1:return f=g.Id(r,"musicTrack"),e=g.Id(r,"transfer"),g.G(fg,ol(V,{mode:"readonly",Wp:!0},function(rA){return g.t1.all([Qp(rA,f,"musicTrack"),Qp(rA,e,"transfer"),m9(rA,"musicTrack"),m9(rA,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:n=fg.G;D=g.H(n);x=D.next().value;E=D.next().value;N=D.next().value;c=D.next().value;z=x;M=E;w=N;b=c;if(!z){fg.qk(3);break}return g.G(fg,Omf(z,w),4);case 4:return W=fg.G,g.G(fg,bJ(W),3);case 3:K=[];F=g.H(b);for(l=F.next();!l.done;l=F.next())B=l.value,P=g.VG(B.key).entityId,p=HK(B),dA=g.VG(p.action.entityKey).entityId,P!==r&&dA!==r||z8(I,B.actionProto)||K.push(B.key);return g.G(fg,ol(V,{mode:"readwrite",Wp:!0},function(rA){var ji=K.map(function(k){return vO(rA,k)});
ji.push(vO(rA,f,{uq:!0}));return g.t1.all(ji)}),6);
case 6:MR(M),a&&jY(a),YL(d,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Hr(fg)}})},tP=function(r,V,I,d,a){var f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp,yZ,Kg,fG,O,ng,qm,Wt;
return g.L(function(Ao){switch(Ao.X){case 1:return f=g.Id(r,V),e=g.Id("music_downloads_library_id","musicDownloadsLibraryEntity"),g.G(Ao,ol(I,{mode:"readonly",Wp:!0},function(c9){return g.t1.all([Qp(c9,f,V),Qp(c9,e,"musicDownloadsLibraryEntity"),m9(c9,V),m9(c9,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:n=Ao.G;D=g.H(n);x=D.next().value;E=D.next().value;N=D.next().value;c=D.next().value;z=x;M=E;w=N;b=c;if(!z){Ao.qk(3);break}return g.G(Ao,Omf(z,w),4);case 4:return W=Ao.G,g.G(Ao,bJ(W),3);case 3:K=[];F=new Map;if(!z){Ao.qk(6);break}return g.G(Ao,Wem(z,w,M),7);case 7:K=Ao.G;l=g.H(K);for(B=l.next();!B.done;B=l.next())P=B.value,p=g.VG(P).entityId,F.set(p,{videoId:p,playlistId:r,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.G(Ao,r0(I,"transfer"),8);case 8:for(dA=Ao.G,fg=
g.H(dA),rA=fg.next();!rA.done;rA=fg.next())ji=rA.value,k=g.VG(ji.key).entityId,(bX=F.get(k))&&ji&&(bX.cotn=ji.cotn);case 6:RX=[];Ui=g.H(b);for($f=Ui.next();!$f.done;$f=Ui.next())jp=$f.value,yZ=g.VG(jp.key).entityId,Kg=HK(jp),yZ!==r&&Kg.rootActionId!==r||z8(d,jp.actionProto)||RX.push(jp.key);fG=g.Id(r,V);return g.G(Ao,ol(I,{mode:"readwrite",Wp:!0},function(c9){var Br=RX.map(function(Jo){return vO(c9,Jo)});
Br.push(vO(c9,fG,{uq:!0}));return g.t1.all(Br)}),9);
case 9:if(!z){Ao.qk(0);break}K.reverse();if(!K.length){Ao.qk(0);break}O=g.H(K);ng=O.next();case 12:if(ng.done){Ao.qk(0);break}qm=ng.value;Wt=g.VG(qm).entityId;if(!Wt){Ao.qk(13);break}return g.G(Ao,RW(Wt,I,d,a,F.get(Wt)),13);case 13:ng=O.next(),Ao.qk(12)}})},y$=function(r,V,I){var d,a,f,e,n,D,x;
return g.L(function(E){if(E.X==1)return g.G(E,ol(r,{mode:"readwrite",Wp:!0},function(N){var c=m9(N,"transfer"),z=m9(N,"offlineOrchestrationActionWrapperEntity");return g.t1.all([c,z]).then(function(M){M=g.H(M);var w=M.next().value;var b=M.next().value;M=$c$.map(function(l){return jhY(N,l)});
b=g.H(b);for(var W=b.next();!W.done;W=b.next()){W=W.value;var K=g.VG(W.actionProto.entityKey).entityType==="musicTrack",F=W.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";z8(V,W.actionProto)||K&&(!K||F)||M.push(vO(N,W.key,{uq:!0}))}return g.t1.all(M).then(function(){return w})})}),2);
d=E.G;a=g.H(d);for(f=a.next();!f.done;f=a.next())e=f.value,MR(e),n=g.VG(e.key).entityId,D={videoId:n,offlineDeleteReason:void 0,cotn:e.cotn},jY(D),x=g.Id(n,"musicTrack"),YL(I,{entityKey:x,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.G(E,jNc(),0)})},KeG=function(r){for(var V,I=g.H(r.additionalMetadatas),d=I.next();!d.done;d=I.next())d=d.value,d.offlineMusicVideoData&&(V=d.offlineMusicVideoData);
var a,f,e,n,D;return{id:g.Id(r.videoId,"musicTrack"),videoId:r.videoId,title:r.title,thumbnailDetails:r.thumbnail,lengthMs:String(Number(r.lengthSeconds)*1E3),albumTitle:(a=V)==null?void 0:a.releaseTitle,musicVideoType:(f=V)==null?void 0:f.musicVideoType,contentRating:{explicitType:(e=V)==null?void 0:e.explicitType},artistNames:((n=V)==null?void 0:n.byline)||((D=V)==null?void 0:D.channelName),downloadMetadata:g.Id(r.videoId,"musicTrackDownloadMetadataEntity")}},Wem=function(r,V,I){var d,a,f,e,n,D,
x,E,N,c,z,M,w,b,W,K,F,l;
return g.L(function(B){d=[];a=new Set;if((f=I)==null?0:(e=f.downloadedTracks)==null?0:e.length)for(n=g.H(I.downloadedTracks),D=n.next();!D.done;D=n.next())x=D.value,a.add(x);if(r.tracks){E=g.H(r.tracks);for(N=E.next();!N.done;N=E.next())c=N.value,a.has(c)||d.push(c);z=g.H(V);for(M=z.next();!M.done;M=z.next())if(w=M.value,w.id!==r.id&&(b=w.tracks))for(W=g.H(b),K=W.next();!K.done;K=W.next())F=K.value,l=d.indexOf(F),l!==-1&&d.splice(l,1)}return B.return(d)})},Omf=function(r,V){var I,d,a,f,e,n,D,x;
return g.L(function(E){I=C7(r.thumbnailDetails);d=g.H(V);for(a=d.next();!a.done;a=d.next())if(f=a.value,f.id!==r.id)for(e=g.H(C7(f.thumbnailDetails)),n=e.next();!n.done;n=e.next())D=n.value,x=I.indexOf(D),x!==-1&&I.splice(x,1);return E.return(I)})},R9G=function(r,V){var I,d,a,f,e,n,D,x,E;
return g.L(function(N){if(N.X==1)return I=g.Id("music_downloads_library_id","musicDownloadsLibraryEntity"),g.G(N,hN(r,I,"musicDownloadsLibraryEntity"),2);(d=N.G)||(d={id:I});a=g.VG(V).entityType;a==="musicTrack"?(f=d.downloadedTracks)!=null&&f.includes(V)||(d.downloadedTracks=((e=d.downloadedTracks)!=null?e:[]).concat(V)):a==="musicPlaylist"?(n=d.downloadedPlaylists)!=null&&n.includes(V)||(d.downloadedPlaylists=((D=d.downloadedPlaylists)!=null?D:[]).concat(V)):a!=="musicAlbumRelease"||(x=d.downloadedAlbumReleases)!=
null&&x.includes(V)||(d.downloadedAlbumReleases=((E=d.downloadedAlbumReleases)!=null?E:[]).concat(V));return g.G(N,k3(r,d,"musicDownloadsLibraryEntity"),0)})},tkm=function(r,V){var I,d,a,f,e,n,D;
return g.L(function(x){if(x.X==1)return I=g.Id("music_downloads_library_id","musicDownloadsLibraryEntity"),g.G(x,hN(r,I,"musicDownloadsLibraryEntity"),2);d=x.G;if(!d)return x.qk(0);a=g.VG(V).entityType;a==="musicTrack"?f=d.downloadedTracks:a==="musicPlaylist"&&(f=d.downloadedPlaylists);if((e=f)==null?0:e.length)for(n=0;n<f.length;n++)if(D=f[n],D===V){f.splice(n,1);break}return g.G(x,k3(r,d,"musicDownloadsLibraryEntity"),0)})},yz6=function(r){var V=r.videos;
r=[];var I=[];if(V){V=g.H(V);for(var d=V.next();!d.done;d=V.next()){var a=d.value.offlineVideoData.videoId;d=g.Id(a,"musicTrack");a=g.Id(a,"musicTrackDownloadMetadataEntity");r.push(d);I.push(a)}}return{hk:r,Jk:I}},AP=function(r,V,I){V={track:KeG(V)};
I&&(V.playlistId=I);if(r=g.U(r.actionMetadata,AzK))V.maximumDownloadQuality=r.maximumDownloadQuality;return{musicTrackEntityActionMetadata:V}},Fe$=function(r){var V,I,d,a,f,e,n,D;
return g.L(function(x){switch(x.X){case 1:return V=g.DR(),I=A5$(r),d=g.aE(G9_),g.wA(x,2),f={wu:!0},g.G(x,g.k_(V,I,d,void 0,f),4);case 4:a=x.G;g.$v(x,3);break;case 2:e=g.th(x);if(e instanceof g.eI)throw n="GetOffline network manager error: "+e.message,f7(n,e),Error(n);f7("GetOffline fetch request error",e);throw Error("GetOffline fetch request error");case 3:D=G8(a);if(!a)throw f7("Network request failed"),Error("Network request failed");if(D!==void 0)FE(D);else if(!a.videos||!a.videos.length)throw f7("No data"),
Error("No data");return x.return(a.videos.map(function(E){return E.offlineVideoData}))}})},l2c=function(r){var V,I,d,a,f,e,n,D;
return g.L(function(x){switch(x.X){case 1:return V=g.DR(),I=G3G(r),d=g.aE(G9_),g.wA(x,2),f={wu:!0},g.G(x,g.k_(V,I,d,void 0,f),4);case 4:a=x.G;g.$v(x,3);break;case 2:e=g.th(x);if(e instanceof g.eI)throw n="GetOffline network manager error for playlist: "+e.message,f7(n,e),Error(n);f7("GetOffline fetch request error for playlist",e);throw Error("GetOffline fetch request error for playlist");case 3:D=G8(a);if(!a)throw f7("Network request failed for playlist"),Error("Network request failed for playlist");
if(D!==void 0)FE(D,"playlist");else if(!a.playlists||!a.playlists.length)throw f7("No data for playlist"),Error("No data for playlist");return x.return(a.playlists.map(function(E){return E.offlinePlaylistData}))}})},JzG=function(r,V,I,d){var a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp;
return g.L(function(yZ){switch(yZ.X){case 1:return g.G(yZ,V$(),2);case 2:a=yZ.G;if(!a)return yZ.return([]);f=[];if((e=d)==null?0:e.length){f=d;yZ.qk(3);break}return g.G(yZ,r0(a,"mainPlaylistEntity"),4);case 4:f=yZ.G;case 3:if(!f.length)return yZ.return([]);n=[];D=Date.now()/1E3;x=g.H(f);E=x.next();case 5:if(E.done)return n.length?g.G(yZ,Lep(n),10):yZ.return([]);N=E.value;if(!N.downloadState){c=void 0;yZ.qk(8);break}return g.G(yZ,hN(a,N.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:c=
yZ.G;case 8:z=c;M=void 0;b=(w=(M=N)==null?void 0:M.entityMetadata)&&w.nextAutoRefreshIntervalSeconds?Number(w.nextAutoRefreshIntervalSeconds):NaN;W=Number.isNaN(b)?r:b;F=K=void 0;l=((K=z)==null?0:K.lastSyncedTimestampMillis)?Number((F=z)==null?void 0:F.lastSyncedTimestampMillis)/1E3:0;P=B=void 0;p=((B=z)==null?0:B.addedTimestampMillis)?Number((P=z)==null?void 0:P.addedTimestampMillis)/1E3:0;if(I||!w||l+W<=D){dA=[];fg=void 0;if((fg=N.videos)==null?0:fg.length)for(rA=g.H(N.videos),ji=rA.next();!ji.done;ji=
rA.next())k=ji.value,bX=JSON.parse(g.VG(k).entityId),bX.videoId&&dA.push(bX.videoId);RX="0";w&&(Ui=void 0,RX=String(Number((Ui=w.offlineLastModifiedTimestampSeconds)!=null?Ui:0).toFixed()));$f={playlistId:N.playlistId,videoIds:dA,offlineLastModifiedTimestamp:RX,autoSync:V,offlineDateAddedTimestamp:String(p.toFixed())};n.push($f)}E=x.next();yZ.qk(5);break;case 10:return jp=yZ.G,yZ.return(jp)}})},Zme=function(){var r,V,I,d,a;
return g.L(function(f){if(f.X==1)return g.G(f,V$(),2);if(f.X!=3)return(r=f.G)?g.G(f,r0(r,"refresh"),3):f.return(!1);V=f.G;if((I=V[0])==null||!I.refreshTime)return f.return(!1);d=Number(V[0].refreshTime);a=Date.now()/1E3;return f.return(isFinite(d)&&a>=d)})},BWc=function(r,V){var I,d,a;
return g.L(function(f){switch(f.X){case 1:return g.wA(f,2),g.G(f,X49(r,V),4);case 4:return d=f.G,g.G(f,z9e(d),5);case 5:I=CP_(d);g.$v(f,3);break;case 2:a=g.th(f),f7("getAndProcessSmartDownloadsResponse request or processing error",a);case 3:return f.return(I)}})},gym=function(r,V,I,d){var a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp;
return g.L(function(yZ){switch(yZ.X){case 1:return g.G(yZ,V$(),2);case 2:a=yZ.G;if(!a)return yZ.return([]);f=[];if((e=d)==null?0:e.length){f=d;yZ.qk(3);break}return g.G(yZ,r0(a,"musicPlaylist"),4);case 4:f=yZ.G;case 3:if(!f.length)return yZ.return([]);n=[];D=Date.now()/1E3;x=g.H(f);E=x.next();case 5:if(E.done)return n.length?g.G(yZ,Lep(n),10):yZ.return([]);N=E.value;c=void 0;M=(z=(c=N)==null?void 0:c.entityMetadata)&&z.nextAutoRefreshIntervalSeconds?Number(z.nextAutoRefreshIntervalSeconds):NaN;w=
Number.isNaN(M)?r:M;W=b=0;K="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!N.downloadMetadata){yZ.qk(8);break}return g.G(yZ,hN(a,N.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:F=yZ.G,B=l=void 0,b=Number((B=(l=F)==null?void 0:l.addedTimestampMillis)!=null?B:"0")/1E3,p=P=void 0,W=Number((p=(P=F)==null?void 0:P.lastModifiedTimestampMillis)!=null?p:"0")/1E3,fg=dA=void 0,K=(fg=(dA=F)==null?void 0:dA.syncState)!=null?fg:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:rA=void 0;if(I||K!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!z||Number((rA=z.lastSyncedTimestampSeconds)!=null?rA:0)+w<=D){ji=[];k=void 0;if((k=N.tracks)==null?0:k.length)for(bX=g.H(N.tracks),RX=bX.next();!RX.done;RX=bX.next())Ui=RX.value,ji.push(g.VG(Ui).entityId);$f={playlistId:N.playlistId,videoIds:ji,offlineLastModifiedTimestamp:String(W.toFixed()),autoSync:V,offlineDateAddedTimestamp:String(b.toFixed())};n.push($f)}E=x.next();yZ.qk(5);break;case 10:return jp=yZ.G,yZ.return(jp)}})},X49=function(r,V){var I,d,a,f,e,n,D,x,E,N;
return g.L(function(c){switch(c.X){case 1:return I=g.DR(),g.G(c,V$(),2);case 2:d=c.G;if(!d){c.qk(3);break}return g.G(c,BYm(d),4);case 4:a=c.G;case 3:var z=a;f={context:g.V2(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:r},offlineClientState:z,clientStateRequestData:{preferredFormatType:V}}}};e=g.aE(SKG);g.wA(c,5);D={wu:!0};return g.G(c,g.k_(I,f,e,void 0,D),7);case 7:n=c.G;g.$v(c,6);break;case 5:x=g.th(c);if(x instanceof g.eI)throw E=
"DPS network manager error for smart downloads: "+x.message,f7(E,x),Error(E);f7("DPS fetch request error for smart downloads",x);throw Error("DPS fetch request error for smart downloads");case 6:N=G8(n);if(n)N!==void 0&&FE(N,"smart downloads");else throw f7("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return c.return(n)}})},Uco=function(r,V){var I,d,a,f,e,n,D,x;
return g.L(function(E){switch(E.X){case 1:return I=g.DR(),d={context:g.V2(),videoPlaybackPositionEntities:r,lastSyncTimestampUsec:V},a=g.aE(imP),g.wA(E,2),e={wu:!0},g.G(E,g.k_(I,d,a,void 0,e),4);case 4:f=E.G;g.$v(E,3);break;case 2:n=g.th(E);if(n instanceof g.eI)throw D="VPPS network manager error: "+n.message,f7(D,n),Error(D);f7("VPPS fetch request error",n);throw Error("VPPS fetch request error");case 3:x=G8(f);if(f)x!==void 0&&FE(x,"position sync");else throw f7("Network request failed for position sync"),
Error("Network request failed for position sync");return E.return(f)}})},mcP=function(r,V,I){var d,a,f,e,n,D,x,E;
return g.L(function(N){switch(N.X){case 1:d=g.DR();var c=I.refreshData,z=I.isEnqueuedForExpiredStreamUrlRefetch,M=I.xk,w=I.offlineSourceData,b=I.mediaCapabilities,W={entityKey:r};c&&(W.refreshData=c);z&&(W.isExpiredStreamUrlRefetch=z);M&&(W.downloadParameters=M);w&&(W.offlineSourceData=w);c={context:g.f8(V),signatureTimestamp:20199,videos:[W]};b&&(c.mediaCapabilities=b);a=c;f=g.aE(QNG);g.wA(N,2);n={wu:!0};return g.G(N,g.k_(d,a,f,void 0,n),4);case 4:e=N.G;g.$v(N,3);break;case 2:D=g.th(N);if(D instanceof
g.eI)throw x="GetPDE network manager error: "+D.message,f7(x,D),Error(x);f7("GetPDE fetch request error",D);throw Error("GetPDE fetch request error");case 3:E=G8(e);if(e)E!==void 0&&FE(E,"PDE");else throw f7("Network request failed for PDE"),Error("Network request failed for PDE");return N.return(e)}})},G8=function(r){var V;
return(V=r.errorMetadata)==null?void 0:V.status},FE=function(r,V){V=V?" for "+V:"";
if(r===0)throw r="Empty response body"+V,f7(r),Error(r);r="Response with error"+V;f7(r);throw Error(r);},Lep=function(r){var V,I,d,a,f,e,n,D;
return g.L(function(x){switch(x.X){case 1:return V=g.DR(),I=FSf(r),d=g.aE(uKo),g.wA(x,2),f={wu:!0},g.G(x,g.k_(V,I,d,void 0,f),4);case 4:a=x.G;g.$v(x,3);break;case 2:e=g.th(x);if(e instanceof g.eI)throw n="offlinePlaylistSyncCheck network manager error: "+e.message,f7(n,e),Error(n);f7("offlinePlaylistSyncCheck fetch request error",e);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:D=G8(a);if(!a)throw f7("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(D!==void 0)FE(D,"playlist sync");else if(!a.offlinePlaylistSyncCheckDatas||!a.offlinePlaylistSyncCheckDatas.length)throw f7("No data for playlist sync"),Error("No data for playlist sync");return x.return(a.offlinePlaylistSyncCheckDatas.map(function(E){return E.offlinePlaylistSyncCheckData}))}})},lJ=function(r){this.G=r},p4o=function(r,V){var I,d,a,f,e,n;
return g.L(function(D){switch(D.X){case 1:I=new Map,d=g.H(V),a=d.next();case 2:if(a.done){D.qk(4);break}f=a.value;e=I;n=e.set;return g.G(D,r.X(f),5);case 5:n.call(e,f,D.G);a=d.next();D.qk(2);break;case 4:return D.return(I)}})},L7=function(r,V,I,d,a,f){V=g.Id(V,I);
d=Object.assign({},f,{priority:d,retryScheduleIntervalsInSeconds:a});return{actionType:r,entityKey:V,actionMetadata:d}},JP=function(r,V,I,d,a,f){this.status=r;
this.G=V;this.Y=I;this.X=d;this.S=a;this.downloadState=f},vyY=function(r,V,I){this.G=r;
this.yH=V;this.S=I},oye=function(r,V){var I,d,a,f,e,n,D,x,E;
return g.L(function(N){switch(N.X){case 1:return I=V.entityKey,a=(d=g.U(V.actionMetadata,Zl))==null?void 0:d.isEnqueuedForExpiredStreamUrlRefetch,g.wA(N,2),f=void 0,g.G(N,qK_(r,V),4);case 4:f=N.G;g.wA(N,5);var c=(c=g.U(V.actionMetadata,Zl))?{maximumDownloadQuality:c.maximumDownloadQuality}:void 0;return g.G(N,mcP(I,r.yH,{isEnqueuedForExpiredStreamUrlRefetch:a,xk:c,offlineSourceData:f}),7);case 7:e=N.G;g.$v(N,6,2);break;case 5:return g.th(N,2),n=xL(V)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",f7("PDE handleAdd error"),N.return(XE(V,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",n,"DOWNLOAD_STATE_FAILED"));case 6:return g.G(N,PPm(r,e,V),8);case 8:return N.return(XE(V,!0,e.orchestrationActions));case 2:return D=g.th(N),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",E="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",D instanceof g.wC&&D.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
E="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),f7("PDE handleAdd error"),N.return(XE(V,!1,void 0,x,E,"DOWNLOAD_STATE_FAILED"))}})},rOe=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg;
return g.L(function(rA){switch(rA.X){case 1:return I=V.entityKey,d=g.VG(I).entityId,g.G(rA,ol(r.G,{mode:"readonly",Wp:!0},function(ji){var k=Qp(ji,I,"playbackData"),bX=Qp(ji,g.Id(d,"offlineVideoPolicy"),"offlineVideoPolicy");ji=Qp(ji,g.Id(d,"transfer"),"transfer");return g.t1.all([k,bX,ji])}),2);
case 2:a=rA.G;f=g.H(a);e=f.next().value;n=f.next().value;D=f.next().value;x=e;E=n;N=D;if(!x||!E)return rA.return(XE(V,!0));c=[];w=((M=x)==null?0:M.playerResponseJson)?JSON.parse(x.playerResponseJson):null;if(!(N&&w&&r.yH.U("html5_refresh_deprecated_downloads"))){rA.qk(3);break}z=k9o(r,w,N);return g.G(rA,h9f(r,N),4);case 4:c=rA.G;case 3:b={lastPlayerResponseTimestampSeconds:x.playerResponseTimestamp,offlineToken:E.offlineToken,formatIds:c};W={};if((K=N)==null?0:K.maximumDownloadQuality)W.maximumDownloadQuality=
N.maximumDownloadQuality;g.wA(rA,5);F=void 0;return g.G(rA,qK_(r,V),7);case 7:return F=rA.G,g.wA(rA,8),g.G(rA,mcP(I,r.yH,{refreshData:b,xk:W,offlineSourceData:F,mediaCapabilities:z}),10);case 10:l=rA.G;g.$v(rA,9,5);break;case 8:return g.th(rA,5),B=xL(V)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",f7("PDE handleRefresh error"),rA.return(XE(V,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",B,
"DOWNLOAD_STATE_FAILED"));case 9:return g.G(rA,PPm(r,l,V),11);case 11:return rA.return(XE(V,!0,l.orchestrationActions));case 5:return P=g.th(rA),p="PDE handleRefresh error",P instanceof Error&&(p="PDE handleRefresh error: "+P.message),dA="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",fg="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",P instanceof g.wC&&P.type==="QUOTA_EXCEEDED"&&(dA="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",fg="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
f7(p),rA.return(XE(V,!1,void 0,dA,fg,"DOWNLOAD_STATE_FAILED"))}})},qK_=function(r,V){var I,d,a,f;
return g.L(function(e){if(e.X==1)return I=g.VG(V.entityKey).entityId,d=g.Id(I,"videoDownloadContextEntity"),g.G(e,hN(r.G,d,"videoDownloadContextEntity"),2);a=e.G;return(f=a)!=null&&f.offlineModeType?e.return({offlineModeType:a.offlineModeType}):e.return(void 0)})},PPm=function(r,V,I){var d,a,f,e,n;
return g.L(function(D){if(D.X==1){if(!V.frameworkUpdates||!g.U(V.frameworkUpdates,$L))return D.return();if(!(g.U(V.frameworkUpdates,$L).mutations&&g.U(V.frameworkUpdates,$L).mutations.length>0&&g.U(V.frameworkUpdates,$L).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return D.qk(2);d=g.VG(g.U(V.frameworkUpdates,$L).mutations[0].entityKey).entityId;return g.G(D,K7(r.G,d),3)}if(D.X!=2){a=D.G;f=g.U(I.actionMetadata,Zl);if(n=(e=f)==null?void 0:e.playlistId)a.playlistId=n;a.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.VO(r.yH)?g.G(D,WK(d,r.G,I,r.S,a),2):g.ih(r.yH)?g.G(D,RW(d,r.G,I,r.S),2):D.qk(2)}return g.G(D,bb9(g.U(V.frameworkUpdates,$L)),0)})},XE=function(r,V,I,d,a,f){return new JP(V?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",xL(r),I,d,a,f)},k9o=function(r,V,I){V=YKc(r.yH,I.cotn,V);
I=g.EQ(V);return g.oCv(V,I,r.yH)},h9f=function(r,V){var I,d,a,f,e,n,D,x,E,N,c;
return g.L(function(z){if(z.X==1)return I=[],g.G(z,ol(r.G,{mode:"readonly",Wp:!0},function(M){var w=[],b=V.offlineVideoStreams;if(b){b=g.H(b);for(var W=b.next();!W.done;W=b.next())w.push(Qp(M,W.value,"offlineVideoStreams"))}return g.t1.all(w)}),2);
if(d=z.G)for(a=g.H(d),f=a.next();!f.done;f=a.next())if(e=f.value,n=void 0,(n=e)==null?0:n.streamsProgress)for(D=e.streamsProgress,x=0;x<D.length;x++)E=D[x],N=JSON.parse(E.formatStreamBytes),c={itag:N.itag,lmt:N.lastModified,xtags:N.xtags},I.push(c);return z.return(I)})},VN9=function(r,V){this.G=r;
this.yH=V},IXm=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z;
return g.L(function(M){switch(M.X){case 1:return I=xL(V),g.G(M,r0(r.G,"videoPlaybackPositionEntity"),2);case 2:d=M.G;if(d.length===0)return M.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));g.wA(M,3);return g.G(M,SV.getInstance(),5);case 5:a=M.G;if(!a)throw Error("prefStorage is undefined");return g.G(M,a.get("psi"),6);case 6:return f=M.G,D=(n=(e=f)==null?void 0:e.KD)!=null?n:"0",g.G(M,Uco(d,D),7);case 7:return x=M.G,E={isPaused:x.watchHistoryPaused,KD:x.syncTimestampUsec},g.G(M,a.set("psi",
E),8);case 8:if(E.isPaused){M.qk(9);break}N=g.U(x.frameworkUpdates,$L);if(!x.frameworkUpdates||!N){M.qk(9);break}return g.G(M,bb9(N),9);case 9:g.$v(M,4);break;case 3:return c=g.th(M),z="PPE handleRefresh error: "+(c instanceof Error?c.message:"unknown error"),f7(z),M.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return M.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I))}})},aXG=function(r,V){var I,d,a,f,e,n,D,x;
return g.L(function(E){switch(E.X){case 1:return I=xL(V),d=g.VG(V.entityKey).entityId,g.wA(E,2),g.G(E,SV.getInstance(),4);case 4:a=E.G;if(!a)throw Error("prefStorage is undefined");return g.G(E,a.get("psi"),5);case 5:f=E.G;e=g.U(V.actionMetadata,dAe);if(((n=f)==null?void 0:n.isPaused)!==!1||(D=e)==null||!D.lastPlaybackPositionSeconds){E.qk(6);break}x={key:g.Id(d,"videoPlaybackPositionEntity"),videoId:d,lastPlaybackPositionSeconds:e.lastPlaybackPositionSeconds};return g.G(E,k3(r.G,x,"videoPlaybackPositionEntity"),
6);case 6:g.$v(E,3);break;case 2:return g.th(E),E.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return E.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I))}})},fXf=function(r,V){var I,d,a;
return g.L(function(f){switch(f.X){case 1:I=xL(V);g.wA(f,2);d=g.VG(V.entityKey).entityId;if(d==="!*$_ALL_ENTITIES_!*$")return g.G(f,McG(r.G),5);a=g.Id(d,"videoPlaybackPositionEntity");return g.G(f,zPp(r.G,a),5);case 5:g.$v(f,3);break;case 2:return g.th(f),f.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I))}})},eG$=function(r,V){this.api=r;
this.G=V;this.logger=new g.xP("woffle");this.X=!1;this.m_={wd:this.wd};this.logger.debug("Initialized OfflineMediaManager")},Y8f=function(r){return g.L(function(V){return V.return(y5G(r))})},nSP=function(r){var V;
return g.L(function(I){if(I.X==1)return g.G(I,g.DEX(r),2);V=I.G;return I.return(V.filter(function(d){return!!d.url}).map(function(d){return d.url}))})},BK=function(r,V){var I=g.Li(V);
if(I===1||I===0)return Promise.resolve();(I=js9(r,V))&&I.stopVideo();r.S=0;return Y8f(V)},g0=function(r,V,I,d){I=I===void 0?!1:I;
d=d===void 0?!0:d;var a=typeof V==="string"?V:V.videoDetails.videoId;g.Li(a)===2&&((V=js9(r,a))?V.stopVideo():r.logger.info(function(){return"Corresponding player for "+a+" not found. Pausing anyway"}),g.JI(a,2),r.S=2,I?DAm(r.G):d&&xAo(r.G))},js9=function(r,V){var I;
return((I=r.player)==null?void 0:I.getVideoData().videoId)===V?r.player:null},ESc=function(r,V,I){V.getPlayerResponse();
g.JI(V.videoId,2);r.S=2;r.X=!1;var d;(d=r.player)==null||d.dispose();r.player=r.api.uO(V);V={};r.player.SU((V.localmediachange=r.xL,V.signatureexpired=r.CZ,V.statechange=r.HFs,V),r);var a=r.wd(I);r.player.VV(g.c7(a,a,!0,"m"),!1);r.logger.debug(function(){return"Starting headless playback with quality: "+a});
r.player.qZ(!1)},N3G=function(r,V){this.G=r;
this.yH=V},cO_=function(r,V){var I,d;
return g.L(function(a){switch(a.X){case 1:return I=xL(V),g.G(a,hN(r.G,V.entityKey,"transfer"),2);case 2:if(d=a.G)return a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));g.wA(a,3);return g.G(a,ssG(r,V),5);case 5:g.$v(a,4);break;case 3:return g.th(a),a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I))}})},zG9=function(r,V){var I,d;
return g.L(function(a){switch(a.X){case 1:return I=xL(V),g.G(a,hN(r.G,V.entityKey,"transfer"),2);case 2:d=a.G;if(!d||d.transferState!=="TRANSFER_STATE_COMPLETE")return a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));g.wA(a,3);return g.G(a,ssG(r,V,!0),5);case 5:g.$v(a,4);break;case 3:return g.th(a),a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I))}})},MNm=function(r,V){var I,d,a,f,e,n,D,x,E,N;
return g.L(function(c){switch(c.X){case 1:return I=xL(V),d=g.VG(V.entityKey).entityId,g.G(c,ol(r.G,{mode:"readonly",Wp:!0},function(z){var M=Qp(z,V.entityKey,"transfer");z=Qp(z,g.Id(d,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.t1.all([M,z])}),2);
case 2:a=c.G;f=g.H(a);e=f.next().value;n=f.next().value;D=e;x=n;if(!D||D.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return c.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));g.wA(c,3);D.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.G(c,k3(r.G,D,"transfer"),5);case 5:E=g.VG(D.key).entityId;Vk_({videoId:E,qT:D,offlineModeType:(N=x)==null?void 0:N.offlineModeType});g.$v(c,4);break;case 3:return g.th(c),c.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return c.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I))}})},ssG=function(r,V,I){I=I===void 0?!1:I;
var d,a,f,e,n,D,x,E,N,c,z,M,w,b,W;return g.L(function(K){switch(K.X){case 1:return d=g.U(V.actionMetadata,CF9),a=g.VG(V.entityKey).entityId,f=g.Id(a,"downloadStatusEntity"),g.G(K,ol(r.G,{mode:"readonly",Wp:!0},function(F){var l=Qp(F,f,"downloadStatusEntity");F=Qp(F,g.Id(a,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.t1.all([l,F])}),2);
case 2:return e=K.G,n=g.H(e),D=n.next().value,x=n.next().value,E=D,N=x,c="TRANSFER_STATE_TRANSFER_IN_QUEUE",((z=E)==null?void 0:z.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(c="TRANSFER_STATE_PAUSED_BY_USER"),b={key:V.entityKey,transferState:c,cotn:g.RM(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(M=d)==null?void 0:M.maximumDownloadQuality,preferredAudioTrack:(w=d)==null?void 0:w.preferredAudioTrack,transferRetryCount:0,isRefresh:I,hasLoggedFirstStarted:!1},g.G(K,ol(r.G,
{mode:"readwrite",Wp:!0},function(F){var l=[];I&&l.push(vO(F,g.Id(a,"offlineVideoStreams")));l.push(pu(F,b,"transfer"));return g.t1.all(l)}),3);
case 3:if(!I){K.qk(4);break}return g.G(K,Y8f(a),4);case 4:hPc({videoId:a,qT:b,offlineModeType:(W=N)==null?void 0:W.offlineModeType}),g.Hr(K)}})},HL_=function(r,V,I,d){if(!r.action.entityKey)throw Error("entityKey is missing.");
var a=g.VG(r.action.entityKey);a={entityType:a.pX,entityId:a.entityId,offlineOrchestrationActionType:r.action.actionType,orchestrationAction:{orchestrationActionId:r.actionId}};V&&(a.offlineOrchestrationActionResult=V.status,a.isRetryable=I?!1:V.G,V.S&&(a.offlineOrchestrationFailureReason=T3e(V.S,a.isRetryable)));var f,e;if((f=r.action.actionMetadata)==null?0:(e=f.offlineLoggingData)==null?0:e.offlineModeType)a.offlineModeType=r.action.actionMetadata.offlineLoggingData.offlineModeType;d&&(a.additionalOrchestrationActions=
d.map(function(n){return{orchestrationActionId:n.actionId}}));
return a},T3e=function(r,V){return r!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||V?r==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&V?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":r:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},wmP=function(r,V){var I={offlineOrchestrationContext:HL_(r)};
V=Zbe(V,I);XAY(J56(),V,r.rootActionId)},bLK=function(r,V,I,d){d=d===void 0?[]:d;
V={offlineOrchestrationContext:HL_(r,V,I,d)};V=Zbe(3,V);XAY(J56(),V,r.rootActionId)},OLG=function(){this.actions=[]},WTe=function(r,V){V=g.H(V);
for(var I=V.next();!I.done;I=V.next())I=I.value,wmP(I,1),r.actions.push(I);r.actions.sort(r.G)},$AG=function(r,V){if(V)for(var I=0;I<r.actions.length;I++)if(V==="!*$_ALL_ENTITIES_!*$"&&r.actions[I].actionId!==V||V!=="!*$_ALL_ENTITIES_!*$"&&r.actions[I].rootActionId===V&&r.actions[I].actionId!==V)r.actions.splice(I,1),I--},KTm=function(r,V){r=g.H(r.actions);
for(var I=r.next();!I.done;I=r.next())if(I.value.actionId===V)return!0;return!1},SY=function(r,V,I,d,a){g.X.call(this);
var f=this;this.X=r;this.bL=V;this.QH=I;this.L=d;this.yH=a;this.G=new OLG;this.C=new g.kA;this.S=new g.hz(function(){f.retry()});
this.j=NaN;this.W=!1;this.m_={QZz:function(){return f.G},
qV:function(){return f.C},
wbM:function(){return f.S},
retry:function(){return f.retry()}};
g.S(this,this.S);this.V=this.X.observe(this.kc.bind(this))},yO9=function(r,V,I,d,a){var f;
return g.L(function(e){if(e.X==1)return f=new SY(r,V,I,d,a),g.G(e,RGp(f),2);tNc(f);return e.return(f)})},tNc=function(r){var V=r.G.actions[0];
return r.Y?((V==null?void 0:V.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&r.Y[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(r.W=!0),Promise.resolve()):AOY(r)},AOY=function(r){var V,I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W;
return g.L(function(K){switch(K.X){case 1:if(r.Y)throw Error("Already processing an action");if(r.h0())return K.return();V=r.G.actions.shift();o0o(r.QH,!V);if(V===void 0)return K.return();V.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&V.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&$AG(r.G,V.actionId);I="";V.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&V.rootActionId===V.actionId&&(I=V.actionId);d=[V];r.Y=d;if(a=r.bL[V.entityType]){K.qk(2);break}r.Y=
void 0;return g.G(K,AOY(r),3);case 3:return K.return();case 2:f=g.H(d);for(e=f.next();!e.done;e=f.next())n=e.value,wmP(n,2);g.wA(K,4,5);return g.G(K,p4o(a,d.map(function(F){return F.action})),7);
case 7:D=K.G,x=g.H(d),E=x.next();case 8:if(E.done){K.qk(10);break}N=E.value;c=D.get(N.action);return g.G(K,Gef(r,N,c),9);case 9:E=x.next();K.qk(8);break;case 10:$AG(r.G,I);case 5:g.Ah(K);r.Y=void 0;g.Fj(K,6);break;case 4:return z=g.th(K),f7("Orchestration error",z),g.wA(K,12),g.G(K,FTG(r,d),14);case 14:g.$v(K,5);break;case 12:M=g.th(K);f7("Orchestration retry error",M);w=g.H(d);for(b=w.next();!b.done;b=w.next())W=b.value,W.retryScheduleIndex<3&&WTe(r.G,[W]);K.qk(5);break;case 6:return g.G(K,AOY(r),
0)}})},Gef=function(r,V,I){var d,a,f,e,n,D,x,E,N,c,z,M;
return g.L(function(w){switch(w.X){case 1:d=V.retryScheduleIndex+2===3;if(I.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){w.qk(2);break}if(I.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){w.qk(0);break}bLK(V,I,d);if(I.G&&V.retryScheduleIndex+1<3)return g.G(w,FTG(r,[V]),0);f=((a=I)==null?0:a.X)?I.X:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";e={entityKey:V.action.entityKey,failureReason:f};n=void 0;g.VO(r.yH)?n="mainVideoDownloadStateEntity":g.ih(r.yH)&&(n="musicTrackDownloadMetadataEntity");
if(!n||!I.downloadState){w.qk(7);break}D=g.VG(V.action.entityKey).entityId;return g.G(w,cK(D,n,r.X,I.downloadState),7);case 7:YL(r.L,e);if(I.downloadState==="DOWNLOAD_STATE_FAILED"&&r.yH.U("html5_auto_retry_failed_pde_actions")){w.qk(0);break}f7("Orchestration result is not retryable, deleting action");return g.G(w,zPp(r.X,w0(V).key),0);case 2:x=void 0;try{x=(E=I.Y)==null?void 0:E.map(function(b){return r.createAction(b,V)})}catch(b){return bLK(V,I,d),N={entityKey:V.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},YL(r.L,N),f7("Orchestration subactions creation error",b),w.return()}bLK(V,I,d,x);if(!x){w.qk(12);break}c=x.map(function(b){return w0(b)});
z=0;case 13:if(!(z<x.length)||r.W){w.qk(15);break}return g.G(w,ol(r.X,{mode:"readwrite",Wp:!0},function(b){var W=[];W.push(ePm(b,c.slice(z,z+10),"offlineOrchestrationActionWrapperEntity"));return g.t1.all(W)}),16);
case 16:z+=10;w.qk(13);break;case 15:if(r.W)return r.W=!1,w.return();case 12:return M=w0(V),g.G(w,zPp(r.X,M.key),17);case 17:wmP(V,4),g.Hr(w)}})},ZLP=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z;
return g.L(function(M){I=[];d=Infinity;a=4E3;f=g.H(V);for(e=f.next();!e.done;e=f.next())n=e.value,D=Number(n.enqueueTimeSec),x=lXP(D),E=n.retryScheduleIndex,N=E!=null&&E>0,x>0&&N?(d=Math.min(d,D),a=Math.min(x,a)):I.push(n);isFinite(d)&&(!r.S.isActive()||d<r.j)&&(r.j=d,r.S.start(a));r.C.hZ()||(c=I.length,I=I.filter(function(w){var b;w=((b=w.actionProto)==null?void 0:b.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!LT6.includes(w)}),z=I.length<c,!r.S.isActive()&&z&&r.S.start(1));
I.length>0&&JO_(r,I);return g.G(M,tNc(r),0)})},B3$=function(r){var V,I,d,a,f,e,n;
return g.L(function(D){if(D.X==1)return g.G(D,XmG(r),2);V=D.G;I=[];d=g.H(V);for(a=d.next();!a.done;a=d.next())f=a.value,e=g.VG(f.key),n=e.entityId,KTm(r.G,n)||I.push(f);return g.G(D,ZLP(r,I),0)})},lXP=function(r){r=r*1E3-Date.now();
return r>4E3?4E3:r},FTG=function(r,V){var I,d,a;
return g.L(function(f){I=g.H(V);for(d=I.next();!d.done;d=I.next()){a=d.value;var e=void 0,n=void 0,D=((n=a.action)==null?void 0:(e=n.actionMetadata)==null?void 0:e.retryScheduleIntervalsInSeconds)||[1,2,4];e=1;a.retryScheduleIndex<D.length&&(e=D[a.retryScheduleIndex]);a.G=e*1E3+Date.now();a.retryScheduleIndex++}return g.G(f,gS_(r,V),0)})},RGp=function(r){var V;
return g.L(function(I){if(I.X==1)return g.G(I,r0(r.X,"offlineOrchestrationActionWrapperEntity"),2);V=I.G;return g.G(I,ZLP(r,V),0)})},JO_=function(r,V){V.length!==0&&V.forEach(function(I){I=HK(I);
I.retryScheduleIndex<3&&WTe(r.G,[I])})},XmG=function(r,V){var I;
return g.L(function(d){if(d.X==1)return g.G(d,r0(r.X,"offlineOrchestrationActionWrapperEntity",V),2);I=d.G;return d.return(I.filter(Obm))})},gS_=function(r,V){if(V.length===0)return Promise.resolve([]);
V=V.map(function(I){return w0(I)});
return c59(r.X,V)},S8m=function(r){this.zQ=r;
this.G=void 0},iL$=function(r,V){var I,d,a,f;
return g.L(function(e){I=V.videoId;d=!0;if(V.captionTracks.length)a=Iz6(V),r.G=new g.Tu(r.zQ,V,a);else if(V.JP)f=g.b3O(V),r.G=new g.wz(r.zQ,V.JP,I,f,V.TE,V.eventId),d=V.TE;else return e.return();return e.return(new Promise(function(n){var D;(D=r.G)==null||D.A4({Aa:function(){return g.L(function(x){if(x.X==1)return g.G(x,r.Aa(I,d),2);n();g.Hr(x)})},
HV:function(){}})}))})},UAe=function(r){var V;
return g.L(function(I){if(I.X==1)return g.G(I,tco(r),2);V=I.G;return I.return(!!V&&V.length>0)})},iJ=function(r){g.X.call(this);
this.G=r;this.X=this.G.observe(this.S.bind(this))},QsK=function(r,V){var I,d,a,f,e,n,D;
return g.L(function(x){switch(x.X){case 1:if(V.length===0)return x.return([]);I=V.map(function(E){return g.Id(E,"transfer")});
return g.G(x,r0(r.G,"transfer",I),2);case 2:d=x.G;a=d.filter(Obm).map(function(E){return g.VG(E.key).entityId});
f=V.filter(function(E){return a.indexOf(E)===-1});
if(f.length===0)return x.return([]);e=g.H(f);n=e.next();case 3:if(n.done){x.qk(5);break}D=n.value;return g.G(x,Y8f(D),4);case 4:n=e.next();x.qk(3);break;case 5:return x.return(f)}})},pme=function(r,V,I,d,a,f){var e,n,D;
return g.L(function(x){e="STREAM_TYPE_UNKNOWN";I.video&&I.audio?(e="STREAM_TYPE_AUDIO_AND_VIDEO",f7("unexpected stream type")):I.video&&!I.audio?e="STREAM_TYPE_VIDEO":!I.video&&I.audio&&(e="STREAM_TYPE_AUDIO");n=g.Id(V,"offlineVideoStreams");D={numBytesDownloaded:a.toFixed(),numTotalBytes:f.toFixed(),streamType:e,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(d),itag:e==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(I.itag):void 0};return g.G(x,ol(r,{mode:"readwrite",Wp:!0},
function(E){var N=Qp(E,n,"offlineVideoStreams"),c=Qp(E,g.Id(V,"transfer"),"transfer");return g.t1.all([N,c]).then(function(z){z=g.H(z);var M=z.next().value;z=z.next().value;if(!z)return vO(E,n).then(function(){});
var w=mAK(M);M=uke(M,d,D,n);var b=pu(E,M,"offlineVideoStreams");mAK(M)>w&&(z.lastProgressTimeMs=Date.now().toString());w=[b];z.offlineVideoStreams||(z.offlineVideoStreams=[]);z.offlineVideoStreams.indexOf(n)===-1&&(z.offlineVideoStreams.push(n),w.push(pu(E,z,"transfer")));return g.t1.all(w)})}),0)})},vSG=function(r,V){var I,d,a,f,e;
return g.L(function(n){if(n.X==1)return I=g.Id(V,"offlineVideoStreams"),g.G(n,hN(r,I,"offlineVideoStreams"),2);d=n.G;if(!d||!d.streamsProgress)return n.return();a=g.H(d.streamsProgress);for(f=a.next();!f.done;f=a.next())e=f.value,e.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",e.numTotalBytes!==e.numBytesDownloaded&&(e.numBytesDownloaded=e.numTotalBytes);return g.G(n,k3(r,d,"offlineVideoStreams"),0)})},uke=function(r,V,I,d){if(r&&r.streamsProgress){d=r;
a:{V=V.itag+";"+V.xtags;for(var a=r.streamsProgress,f=0;f<a.length;f++){var e=JSON.parse(a[f].formatStreamBytes);if(e.itag+";"+e.xtags===V){a[f]=I;I=a;break a}}a.push(I);I=a}d.streamsProgress=I}else r={key:d,streamsProgress:[I]};return r},mAK=function(r){if(r==null?0:r.streamsProgress){var V=0;
r=r.streamsProgress;for(var I=0;I<r.length;I++){var d=r[I];isNaN(Number(d.numBytesDownloaded))?f7("stream progress bytes number invalid"):V+=Number(d.numBytesDownloaded)}return V}return 0},q8G=function(r,V,I,d){g.X.call(this);
var a=this;this.X=r;this.api=V;this.Ws=I;this.kc=d;this.C=new g.kA;this.Y=new g.hz(function(){a.G&&a.G.transferState==="TRANSFER_STATE_TRANSFERRING"&&a.C.hZ()&&((a.G.transferRetryCount||0)<3?g0(a.L,a.W,!1,!1):BK(a.L,a.W.videoDetails.videoId),a.pk("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.QH=this.n8=0;this.V=this.j=!1;this.L8=g.zM(this.api.N().experiments,"html5_transfer_processing_logs_interval");this.TQ=new g.Su(this);this.m_={pb0:function(){return a.Y},
iRs:function(){return a.kc},
qV:function(){return a.C}};
this.bL=this.X.observe(this.pc.bind(this));this.L=new eG$(V,this);this.EE=new S8m(V);this.GQ=new iJ(this.X);this.p8=this.C.listen("publicytnetworkstatus-online",this.Iy.bind(this));this.R7=this.C.listen("publicytnetworkstatus-offline",this.CZz.bind(this));this.V=this.api.N().U("html5_less_transfer_processing_logs");g.S(this,this.TQ);this.TQ.K(V,"offlinetransferpause",this.WEk);g.VO(this.api.N())?this.S="mainVideoDownloadStateEntity":g.ih(this.api.N())&&(this.S="musicTrackDownloadMetadataEntity")},
PFe=function(r){return g.L(function(V){if(V.X==1)V=g.G(V,KSm(),2);
else{var I=r.GQ;var d=g.lL();d=Object.keys(d);I=QsK(I,d);V=g.G(V,I,0)}return V})},Q$=function(r,V){V=V===void 0?!1:V;
var I;return g.L(function(d){if(d.X==1){if(r.G)throw Error("Already downloading a video");r.QH=0;r.j=!1;return g.G(d,oSe(r),2)}return d.X!=4?(I=d.G,k3P(r.Ws,!I),I&&r.C.hZ()?V?g.G(d,new Promise(function(a){g.Td(a,1E3)}),4):d.qk(4):(!I&&r.G&&U0(r),d.qk(0))):g.G(d,ke$(r,I),0)})},hG_=function(r){return g.L(function(V){if(V.X==1)return r.W?g.G(V,BK(r.L,r.W.videoDetails.videoId),3):V.qk(0);
U0(r);g.Hr(V)})},rL_=function(r,V){var I,d,a;
return g.L(function(f){switch(f.X){case 1:return g.wA(f,2),(I=!!V.captionTracks.length||!!V.JP)?g.G(f,UAe(V.videoId),4):f.return();case 4:return(d=f.G)?f.return():g.G(f,iL$(r.EE,V),5);case 5:g.$v(f,0);break;case 2:a=g.th(f),f7("Caption downloading error",a,V.cotn),g.Hr(f)}})},ke$=function(r,V){var I,d,a,f,e,n;
return g.L(function(D){switch(D.X){case 1:if(r.j)return D.return();r.j=!0;r.G=V;I=g.VG(r.G.key);d=I.entityId;a=void 0;if(r.G.transferState==="TRANSFER_STATE_TRANSFERRING")return g.G(D,mz(r,d),7);if(r.G.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||r.G.transferRetryCount||r.G.hasLoggedFirstStarted){D.qk(3);break}return g.G(D,mz(r,d),5);case 5:return a=D.G,r.G.hasLoggedFirstStarted=!0,g.G(D,VPp(r),6);case 6:rz_({videoId:d,qT:r.G,offlineModeType:a},void 0,void 0,!0);D.qk(3);break;case 7:a=D.G,
Dl({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:d,qT:r.G,offlineModeType:a});case 3:return g.G(D,Ico(r),8);case 8:return f=null,g.wA(D,9),g.G(D,dXY(r,V),11);case 11:f=D.G;r.W=f;g.$v(D,10);break;case 9:return e=g.th(D),f7("error getting player response",e,V.cotn),g.G(D,r.pk("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return D.return();case 10:return n=YKc(r.api.N(),V.cotn,f),g.G(D,rL_(r,n),13);case 13:return g.G(D,nSP(n.videoId),
14);case 14:n.TC=D.G,ESc(r.L,n,V.maximumDownloadQuality),r.Y.start(108E5),g.Hr(D)}})},oSe=function(r){var V,I;
return g.L(function(d){if(d.X==1)return g.G(d,r0(r.X,"transfer"),2);V=d.G;I=V.filter(acG).sort(fcG);return I.length===0?d.return():d.return(I[0])})},Ico=function(r){var V,I,d;
return g.L(function(a){if(a.X==1){if(!r.G)return uJ(r,"onTransferStart"),a.return();r.Y.start(108E5);return g.G(a,p7(r,"TRANSFER_STATE_TRANSFERRING"),2)}V=r.G;return(d=((I=V)==null?0:I.key)?g.VG(V.key).entityId:"")&&r.S?g.G(a,cK(d,r.S,r.X,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):a.qk(0)})},DAm=function(r){var V,I,d,a;
g.L(function(f){switch(f.X){case 1:if(!r.G){uJ(r,"onTransferPausedByUser");f.qk(2);break}V=r.G;r.Y.stop();return g.G(f,p7(r,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:d=((I=V)==null?0:I.key)?g.VG(V.key).entityId:"";if(!d||!r.S){f.qk(4);break}return g.G(f,cK(d,r.S,r.X,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.G(f,mz(r,d),6);case 6:a=f.G,I29({videoId:d,qT:V,offlineModeType:a});case 2:U0(r),Q$(r),g.Hr(f)}})},xAo=function(r){var V,I,d;
g.L(function(a){if(a.X==1){if(!r.G)return uJ(r,"onTransferPausedByNetwork"),a.return();r.Y.stop();return g.G(a,p7(r,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(a.X!=3)return V=r.G,(d=((I=V)==null?0:I.key)?g.VG(V.key).entityId:"")&&r.S?g.G(a,cK(d,r.S,r.X,"DOWNLOAD_STATE_PAUSED"),3):a.qk(3);U0(r);g.Hr(a)})},e1G=function(r){var V,I,d,a,f;
g.L(function(e){switch(e.X){case 1:if(!r.G)return uJ(r,"onTransferComplete"),e.return();V=r.G;r.Y.stop();if(!V||!r.W){e.qk(2);break}I=YKc(r.api.N(),V.cotn,r.W);return g.G(e,rL_(r,I),2);case 2:return g.G(e,p7(r,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:a=((d=V)==null?0:d.key)?g.VG(V.key).entityId:"";if(!a||!r.S){e.qk(5);break}return g.G(e,cK(a,r.S,r.X,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.G(e,vSG(r.X,a),7);case 7:return g.G(e,mz(r,a),8);case 8:f=e.G,Dl({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:a,qT:V,offlineModeType:f}),U0(r),Q$(r),g.Hr(e)}})},YvG=function(r,V,I){var d,a;
g.L(function(f){switch(f.X){case 1:if(!r.G)return uJ(r,"onTransferProgress: "+V),f.return();if(r.G.transferState==="TRANSFER_STATE_TRANSFERRING"){f.qk(2);break}return g.G(f,Ico(r),2);case 2:d=Date.now();if(!(d-r.n8>1E3)){f.qk(4);break}r.n8=d;return g.G(f,pme(r.X,I.videoId,I.X,I.Av,I.bytesDownloaded,I.G),5);case 5:if(r.V&&!(r.V&&d-r.QH>r.L8)){f.qk(4);break}r.QH=d;return g.G(f,mz(r,V),7);case 7:a=f.G,rz_({videoId:V,qT:r.G,offlineModeType:a},I.bytesDownloaded,I.G);case 4:r.Y.start(108E5),g.Hr(f)}})},
ntf=function(r){var V=(r.G.transferRetryCount||0)<3;
V&&(r=r.G,r.transferRetryCount=(r.transferRetryCount||0)+1);return V},jq9=function(r,V){V=V===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":V;
var I,d,a,f;return g.L(function(e){if(e.X==1)return r.G||uJ(r,"setTransferToFailed: "+V),I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V==="TRANSFER_FAILURE_REASON_NETWORK"?I="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":V==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.G(e,p7(r,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",V),2);if(e.X!=3)return YL(r.kc,{entityKey:(d=r.G)==null?void 0:d.key,failureReason:I}),
a=r.G?g.VG(r.G.key).entityId:"",g.G(e,mz(r,a),3);f=e.G;var n={videoId:a,qT:r.G,offlineModeType:f},D=V,x={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};D&&(x.transferFailureReason=D,x.failureReason=dcG(D));Dl(x,n);g.Hr(e)})},p7=function(r,V,I,d){var a;
return g.L(function(f){if(f.X==1){if(!r.G)return uJ(r,"saveTransferState: "+V),f.return();r.G.transferState=V;r.G.failureReason=d;g.wA(f,2);return g.G(f,VPp(r,function(e){return I?m9(e,"offlineVideoStreams",r.G.offlineVideoStreams).then(function(n){for(var D=g.H(n),x=D.next();!x.done;x=D.next())if((x=x.value)&&x.streamsProgress){x=g.H(x.streamsProgress);for(var E=x.next();!E.done;E=x.next())E.value.streamState=I}return ePm(e,n.filter(function(N){return!!N}),"offlineVideoStreams")}):g.t1.resolve(void 0)}),
4)}if(f.X!=2)return g.$v(f,0);
a=g.th(f);return a instanceof g.wC&&a.type==="QUOTA_EXCEEDED"?g.G(f,r.pk("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):f.qk(0)})},VPp=function(r,V){var I;
return g.L(function(d){if(!r.G)return d.return();I=r.G;return g.G(d,ol(r.X,{mode:"readwrite",Wp:!0},function(a){var f=[pu(a,I,"transfer")];V&&f.push(V(a));return g.t1.all(f)}),0)})},U0=function(r){r.G=void 0;
r.W=void 0;r.Y.stop()},dXY=function(r,V){var I,d,a,f,e;
return g.L(function(n){if(n.X==1)return I=g.VG(V.key),d=I.entityId,a=g.Id(d,"playbackData"),g.G(n,hN(r.X,a,"playbackData"),2);f=n.G;if((e=f)==null?0:e.playerResponseJson)return n.return(JSON.parse(f.playerResponseJson));throw Error("No PlayerResponse found");})},uJ=function(r,V){r.api.Hs("woffle",{mcte:V});
f7("missing current transfer entity.")},mz=function(r,V){var I,d,a;
return g.L(function(f){if(f.X==1)return g.G(f,hN(r.X,g.Id(V,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);I=f.G;return f.return((a=(d=I)==null?void 0:d.offlineModeType)!=null?a:void 0)})},acG=function(r){return DXf[r.transferState]!==void 0},fcG=function(r,V){var I=DXf[r.transferState],d=DXf[V.transferState];
return I!==d?I-d:Number(r.enqueuedTimestampMs)-Number(V.enqueuedTimestampMs)},vK=function(r,V){var I=this;
this.yH=r;this.api=V;this.C=new g.kA;this.W=new g.cA;this.m_={FK:function(){return I.S.m_.FK()},
qV:function(){return I.C},
gsM:function(){return I.S},
nD:function(){return I.nD()},
Js:function(){return I.Js()},
TV:function(){return I.TV()},
jM:function(){return I.jM()},
LK:function(){return I.LK()},
Zx:function(d){return I.Zx(d)}};
this.S=new v0m(function(){return xXG(I)},function(){I.TV()},this.api.dU(),this.api.U.bind(this.api));
this.G=new eY(this.api);qdG(this.S)},xXG=function(r){return g.L(function(V){r.api.Bs("onOrchestrationBecameLeader");
return g.G(V,r.Js(),0)})},N89=function(r){var V,I;
return g.L(function(d){if(d.X==1)return g.G(d,V$(),2);if(d.X!=3){V=d.G;if(!V)return f7("PES is undefined"),d.return();r.X=new q8G(V,r.api,r.S,r.G);I=r.YW(V);return g.G(d,yO9(V,I,r.S,r.G,r.yH),3)}r.L=d.G;return g.G(d,Etc(r),0)})},Etc=function(r){var V;
return g.L(function(I){switch(I.X){case 1:if(!r.X)return f7("transferManager is undefined"),I.return();if(r.X.G){I.qk(2);break}return g.G(I,Q$(r.X),2);case 2:if(!r.yH.U("woffle_enable_main_downloads_library")){I.qk(4);break}return g.G(I,r.Yu(),4);case 4:if(!r.yH.U("html5_offline_playback_position_sync")){I.qk(6);break}return g.G(I,r.vc(),7);case 7:return g.G(I,r.Zx(864E5),6);case 6:return g.G(I,r.refreshAllStaleEntities(43200,!0),9);case 9:return g.G(I,r.vI(),10);case 10:if(!r.yH.U("html5_retry_downloads_for_expiration")){I.qk(11);
break}return g.G(I,r.LK(),11);case 11:return r.j=g.HR(function(){r.refreshAllStaleEntities(43200,!0);r.vI()},9E5),g.IY(g.aY(),function(){return r.jM()}),g.G(I,V$(),13);
case 13:return V=I.G,g.G(I,pAG(V),14);case 14:Pa$(r.S),g.Hr(I)}})},sqp=function(){var r,V,I,d,a,f;
return g.L(function(e){switch(e.X){case 1:return g.G(e,V$(),2);case 2:r=e.G;if(!r)return e.return([]);V=Date.now()/1E3;return g.G(e,r0(r,"offlineVideoPolicy"),3);case 3:I=e.G,d=g.H(I),a=d.next();case 4:if(a.done){e.qk(6);break}f=a.value;if(!(f.expirationTimestamp&&Number(f.expirationTimestamp)<V)){e.qk(5);break}f.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";f.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.G(e,k3(r,f,"offlineVideoPolicy"),5);
case 5:a=d.next();e.qk(4);break;case 6:return e.return(I.map(function(n){return n.key}))}})},qR=function(r,V,I,d,a){var f,e,n;
return g.L(function(D){if(D.X==1)return g.G(D,V$(),2);f=D.G;if(!f)return D.return([]);e=V.map(function(x){var E=g.Id(x,I);E={actionType:d,entityKey:E,actionMetadata:Object.assign({},ny_(),a)};d!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(E.actionMetadata.priority=0);x=new T8(I,x,E);return w0(x)});
n=c59(f,e);qdG(r.S);return D.return(n)})},cLm=function(r,V,I,d){var a,f,e,n,D,x,E,N;
return g.L(function(c){switch(c.X){case 1:a=[],f=g.H(V),e=f.next();case 2:if(e.done){c.qk(4);break}n=e.value;if(n.upToDate||I&&!n.shouldAutoSyncMetadata||!n.playlistId){c.qk(3);break}D={};switch(d){case "mainPlaylistEntity":x={nextAutoRefreshIntervalSeconds:n.checkInSeconds,autoSync:I};D={mainPlaylistEntityActionMetadata:x};break;case "musicPlaylist":E={autoSync:I},D={musicPlaylistEntityActionMetadata:E}}return g.G(c,qR(r,[n.playlistId],d,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",D),6);case 6:(N=
c.G)&&a.push.apply(a,g.R(N));case 3:e=f.next();c.qk(2);break;case 4:return c.return(a)}})},z1G=function(r,V){var I;
return g.L(function(d){return V.length?(I=ny_(),g.ms(I,Zl,{isEnqueuedForExpiredStreamUrlRefetch:!0}),r.api.Hs("qrd",{v:V.length}),d.return(qR(r,V,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",I))):d.return([])})},MP_=function(r,V,I){this.G=r;
this.yH=V;this.S=I},H2P=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K;
return g.L(function(F){switch(F.X){case 1:return I=xL(V),d=g.VG(V.entityKey),a=d.entityId,f=[],g.wA(F,2),g.G(F,C9$(r,a),4);case 4:f=F.G;if(!(r.yH.U("woffle_enable_main_downloads_library")&&((e=f)==null?0:e.length))){F.qk(5);break}return g.G(F,w4P(r.G,[V.entityKey]),5);case 5:g.$v(F,3);break;case 2:return n=g.th(F),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.wC&&n.type==="QUOTA_EXCEEDED"?(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):f7("Playlist add error"),F.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,D,x));case 3:E=[];if(!r.yH.U("html5_offline_prevent_redownload_downloaded_video")){F.qk(7);break}return g.G(F,e9G(r.G,"mainVideoEntity",f),8);case 8:f=F.G;case 7:if((N=f)==null?0:N.length)for(c=g.H(f),z=c.next();!z.done;z=c.next())if(M=z.value,w=M.offlineVideoData,b=void 0,(b=w)==null?0:b.videoId)W=void 0,K=Number(((W=V.actionMetadata)==null?void 0:W.priority)||
0)+1,E.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w.videoId,"mainVideoEntity",K,PK,T8e(V,w,a)));return F.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,E))}})},b2o=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp,yZ,Kg,fG,O,ng,qm,Wt,Ao,c9,Br,Jo,G6,t,y,A,Z,Q,Wr,IX,Cg,aX,GS,oX,O_,$r,Jr,vM,vt,q6,O5,cv,FY,TP,lg,Ue,Qk,tC,e1,PM,jS,Az,p2;
return g.L(function(TF){switch(TF.X){case 1:return I=xL(V),d=V.entityKey,a=g.VG(d).entityId,f=[],e=!1,a==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.G(TF,r0(r.G,"mainPlaylistEntity"),5)):g.G(TF,hN(r.G,d,"mainPlaylistEntity"),4);case 4:(n=TF.G)&&f.push(n);TF.qk(3);break;case 5:f=TF.G;case 3:if((D=f)==null||!D.length)return TF.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));x=g.U(V.actionMetadata,wye);N=(E=x)==null?void 0:E.nextAutoRefreshIntervalSeconds;z=(c=x)==null?void 0:c.autoSync;M=[];b=w=
!0;W=!1;if(!e&&z===!1){TF.qk(6);break}g.wA(TF,7);return g.G(TF,JzG(0,!!z,!0,f),9);case 9:M=TF.G;g.$v(TF,8);break;case 7:K=g.th(TF);if(!(K instanceof Error&&K.message==="No data")){K instanceof Error&&K.message==="Empty response body"&&f7(K.message);TF.qk(8);break}return a==="!*$_ALL_ENTITIES_!*$"?g.G(TF,cz$(r.G,V,r.S,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.G(TF,NWe(a,r.G,V,r.S),8);case 8:if(!M.length||!e&&M[0].playlistId!==a)return TF.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I));case 6:if(e){F=[];l=g.H(M);for(B=l.next();!B.done;B=l.next())P=B.value,P.upToDate||z&&!P.shouldAutoSyncMetadata||!P.playlistId||(p={nextAutoRefreshIntervalSeconds:P.checkInSeconds,autoSync:z},F.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P.playlistId,"mainPlaylistEntity",0,PK,{mainPlaylistEntityActionMetadata:p})));return TF.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,F))}M.length&&(dA=M[0],W=!!dA.upToDate,z&&(w=(fg=dA.shouldAutoSyncMetadata)!=null?fg:!0,b=(rA=dA.shouldAutoSyncVideos)!=
null?rA:!0,dA.checkInSeconds&&(N=dA.checkInSeconds)));if(W||!w)return TF.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));ji=[];k=f[0];if(!k.downloadState){bX=void 0;TF.qk(15);break}return g.G(TF,hN(r.G,k.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:bX=TF.G;case 15:return RX=bX,$f=((Ui=RX)==null?0:Ui.addedTimestampMillis)?String(RX.addedTimestampMillis):void 0,g.wA(TF,17),g.G(TF,C9$(r,a,$f,N),19);case 19:ji=TF.G;g.$v(TF,18);break;case 17:jp=g.th(TF);if(!(jp instanceof
Error&&jp.message==="No data for playlist")){if(jp instanceof Error&&jp.message==="Empty response body for playlist")f7(jp.message);else return yZ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Kg="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",jp instanceof g.wC&&jp.type==="QUOTA_EXCEEDED"&&(yZ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Kg="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),TF.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,yZ,Kg));
TF.qk(18);break}return g.G(TF,NWe(a,r.G,V,r.S),18);case 18:if(!b)return TF.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));fG=[];O=new Map;if((ng=ji)==null?0:ng.length)for(qm=g.H(ji),Wt=qm.next();!Wt.done;Wt=qm.next())Ao=Wt.value,c9=Ao.offlineVideoData,Br=void 0,((Br=c9)==null?0:Br.videoId)&&O.set(c9.videoId,c9);Jo=new Map;G6=[];if((t=k)==null?0:(y=t.videos)==null?0:y.length)for(A=g.H(k.videos),Z=A.next();!Z.done;Z=A.next())if(Q=Z.value,Wr=JSON.parse(g.VG(Q).entityId),IX=Wr.videoId)O.has(IX)?
(Jo.set(IX,O.get(IX)),O.delete(IX)):G6.push(IX);aX=Number(((Cg=V.actionMetadata)==null?void 0:Cg.priority)||0)+1;GS=g.H(O.entries());for(oX=GS.next();!oX.done;oX=GS.next())O_=oX.value,$r=g.H(O_),Jr=$r.next().value,vM=$r.next().value,vt=Jr,q6=vM,fG.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",vt,"mainVideoEntity",aX,PK,T8e(V,q6,a)));O5=g.H(Jo.entries());for(cv=O5.next();!cv.done;cv=O5.next())FY=cv.value,TP=g.H(FY),lg=TP.next().value,Ue=TP.next().value,Qk=lg,tC=Ue,fG.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Qk,"mainVideoEntity",aX,PK,T8e(V,tC,a)));e1=g.H(G6);for(PM=e1.next();!PM.done;PM=e1.next())jS=PM.value,Az={playlistId:a},p2={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Az},fG.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",jS,"mainVideoEntity",0,PK,p2));return TF.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,fG))}})},O2G=function(r,V){var I,d,a,f;
return g.L(function(e){switch(e.X){case 1:return I=xL(V),g.wA(e,2),d=g.VG(V.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.G(e,cz$(r.G,V,r.S,(a=V.actionMetadata)==null?void 0:(f=a.offlineLoggingData)==null?void 0:f.offlineDeleteReason),5):g.G(e,NWe(d,r.G,V,r.S),6);case 6:if(!r.yH.U("woffle_enable_main_downloads_library")){e.qk(5);break}return g.G(e,bme(r.G,V.entityKey),5);case 5:g.$v(e,3);break;case 2:return g.th(e),e.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return e.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I))}})},C9$=function(r,V,I,d){var a,f,e,n,D,x,E;
return g.L(function(N){switch(N.X){case 1:return g.G(N,l2c([V]),2);case 2:return a=N.G,g.G(N,WkG(r,a[0],I,d),3);case 3:return f=N.G,e=f.mainPlaylistEntity,n=f.dmz,x=xc6(e,(D=n)==null?void 0:D.avatar),g.wA(N,4),g.G(N,O0(x),6);case 6:g.$v(N,5);break;case 4:E=g.th(N),E instanceof Error&&E.message==="Failed to fetch"&&f7(E.message);case 5:return N.return(a[0].videos)}})},WkG=function(r,V,I,d){var a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l;
return g.L(function(B){switch(B.X){case 1:a=Date.now().toString();I||(I=a);f=V.videos;e=V.playlistId;n=[];D=[];if(f)for(x=g.H(f),E=x.next();!E.done;E=x.next()){N=E.value;c=N.offlineVideoData;if(!c||!c.videoId)throw f7("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");z=c.videoId;M={videoId:z,playlistId:e};w={id:g.Id(JSON.stringify(M),"mainPlaylistVideoEntity"),video:g.Id(z,"mainVideoEntity")};n.push(w);D.push(w.id)}W={key:g.Id(e,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:I,lastSyncedTimestampMillis:a};K={key:g.Id(e,"mainPlaylistEntity"),playlistId:e,videos:D,title:V.title,thumbnailStyleData:$Xm(V),visibility:Kko(V),downloadState:W.key};V.channel&&(F=V.channel.offlineChannelData,b=R19(g.Id(e,"ytMainChannelEntity"),F),K.channelOwner=b.id);((l=K)==null?0:l.entityMetadata)?(K.entityMetadata.offlineLastModifiedTimestampSeconds=V.lastModifiedTimestamp,d&&(K.entityMetadata.nextAutoRefreshIntervalSeconds=String(d))):K&&(K.entityMetadata={nextAutoRefreshIntervalSeconds:d?
String(d):void 0,offlineLastModifiedTimestampSeconds:V.lastModifiedTimestamp});g.wA(B,2);return g.G(B,ol(r.G,{mode:"readwrite",Wp:!0},function(P){var p=pu(P,K,"mainPlaylistEntity"),dA=pu(P,W,"mainPlaylistDownloadStateEntity");p=[p,dA];dA=g.H(n);for(var fg=dA.next();!fg.done;fg=dA.next())p.push(pu(P,fg.value,"mainPlaylistVideoEntity"));b&&p.push(pu(P,b,"ytMainChannelEntity"));return g.t1.all(p)}),4);
case 4:g.$v(B,3);break;case 2:throw g.th(B),f7("PES failure for playlist"),Error("PES failure for playlist");case 3:return B.return({mainPlaylistEntity:K,dmz:b,GCc:n})}})},R19=function(r,V){return{id:r,
channelId:V.channelId,title:V.title,avatar:V.thumbnail}},$Xm=function(r){var V=[],I=r.videos;
I&&I.length>0&&V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:I[0].offlineVideoData.thumbnail}}});if((r=r.additionalMetadadatas)&&r.length>0)for(r=g.H(r),I=r.next();!I.done;I=r.next()){var d=I.value.offlineBundleItemPlaylistData,a=void 0;I=(a=d)==null?void 0:a.style;a=void 0;d={collageThumbnail:{coverThumbnail:(a=d)==null?void 0:a.coverThumbnail}};switch(I){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:d});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:d});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:d});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:d})}}return V},Kko=function(r){switch(r.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},T8e=function(r,V,I){V={offlineVideoData:V,
playlistId:I};if(r=g.U(r.actionMetadata,wye))V.maximumDownloadQuality=r.maximumDownloadQuality;return{mainVideoEntityActionMetadata:V}},tPp=function(r,V,I){this.G=r;
this.yH=V;this.S=I},G$c=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M;
return g.L(function(w){switch(w.X){case 1:return I=xL(V),d=g.VG(V.entityKey),a=d.entityId,f=g.U(V.actionMetadata,oW),n=!((e=f)==null?0:e.playlistId),g.wA(w,2),g.G(w,yLm(r,a,void 0,(D=f)==null?void 0:D.offlineVideoData,n),4);case 4:g.$v(w,3);break;case 2:return x=g.th(w),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.wC&&x.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,E,N));case 3:c=1;c=Number(((z=V.actionMetadata)==null?void 0:z.priority)||0)+1;var b=(b=g.U(V.actionMetadata,oW))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;M=L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a,"playbackData",c,ALG,b);return w.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,[M]))}})},Fkc=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K;
return g.L(function(F){switch(F.X){case 1:return I=xL(V),d=g.VG(V.entityKey),a=d.entityId,g.G(F,hN(r.G,V.entityKey,"mainVideoEntity"),2);case 2:f=F.G;if(!f){e=void 0;F.qk(3);break}return g.G(F,hN(r.G,f.downloadState,"mainVideoDownloadStateEntity"),4);case 4:e=F.G;case 3:n=e;if(!f||!n)return F.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));g.wA(F,5);return g.G(F,yLm(r,a,n.addedTimestampMillis,(x=g.U(V.actionMetadata,oW))==null?void 0:x.offlineVideoData),7);case 7:E=1;E=Number(((N=
V.actionMetadata)==null?void 0:N.priority)||0)+1;D=L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",a,"playbackData",E,ALG);g.$v(F,6);break;case 5:c=g.th(F);if(!(c instanceof Error&&c.message==="No data")){if(c instanceof Error&&c.message==="Empty response body")f7(c.message);else return z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",M="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.wC&&c.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
M="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),F.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,z,M));F.qk(6);break}return g.G(F,K7(r.G,a),9);case 9:w=F.G;b=g.U(V.actionMetadata,oW);if(K=(W=b)==null?void 0:W.playlistId)w.playlistId=K;w.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.G(F,WK(a,r.G,V,r.S,w),6);case 6:return F.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,D?[D]:void 0))}})},lcP=function(r,V){var I,d,a,f,e,n,D,x,E,N;
return g.L(function(c){switch(c.X){case 1:return I=xL(V),g.wA(c,2),d=g.VG(V.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.G(c,cz$(r.G,V,r.S,(E=V.actionMetadata)==null?void 0:(N=E.offlineLoggingData)==null?void 0:N.offlineDeleteReason),5):g.G(c,K7(r.G,d),6);case 6:a=c.G;f=g.U(V.actionMetadata,oW);if(n=(e=f)==null?void 0:e.playlistId)a.playlistId=n;a.offlineDeleteReason=(D=V.actionMetadata)==null?void 0:(x=D.offlineLoggingData)==null?void 0:x.offlineDeleteReason;return g.G(c,WK(d,r.G,V,r.S,a),7);
case 7:if(!r.yH.U("woffle_enable_main_downloads_library")){c.qk(5);break}return g.G(c,bme(r.G,V.entityKey),5);case 5:g.$v(c,3);break;case 2:return g.th(c),c.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I))}})},yLm=function(r,V,I,d,a){var f,e,n,D,x,E;
return g.L(function(N){switch(N.X){case 1:if(f=d){N.qk(2);break}return g.G(N,Fe$([V]),3);case 3:e=N.G,f=e[0];case 2:return g.G(N,LkG(r,f,I,a),4);case 4:n=N.G;D=n.mainVideoEntity;x=n.channelEntity;g.wA(N,5);var c=C7(D.thumbnail),z=C7(x.avatar);return g.G(N,O0(c.concat(z)),7);case 7:g.$v(N,0);break;case 5:E=g.th(N),E instanceof Error&&E.message==="Failed to fetch"&&f7(E.message),g.Hr(N)}})},LkG=function(r,V,I,d){var a,f,e,n,D,x,E,N,c,z,M,w,b;
return g.L(function(W){switch(W.X){case 1:I||(I=Date.now().toString());f=(a=V.channel)==null?void 0:a.offlineChannelData;e={id:g.Id(V.videoId,"ytMainChannelEntity"),channelId:f.channelId,title:f.title,avatar:f.thumbnail};n={key:g.Id(V.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Id(V.videoId,"playbackData"),addedTimestampMillis:I,videoDownloadContextEntity:g.Id(V.videoId,"videoDownloadContextEntity")};D={key:g.Id(V.videoId,"videoPlaybackPositionEntity"),videoId:V.videoId,lastPlaybackPositionSeconds:"0"};
r.yH.U("html5_offline_playback_position_sync")&&(x={playbackPosition:D.key});E=g.Id(V.videoId,"mainVideoEntity");N={key:E,videoId:V.videoId,title:V.title,thumbnail:V.thumbnail,localizedStrings:{viewCount:V.shortViewCountText},userState:x,lengthSeconds:V.lengthSeconds?Number(V.lengthSeconds):void 0,publishedTimestampMillis:V.publishedTimestamp?(Number(V.publishedTimestamp)*1E3).toString():void 0,formattedDescription:V.description,owner:e.id,downloadState:n.key};if(!r.yH.U("woffle_enable_main_downloads_library")||
!d){W.qk(2);break}return g.G(W,HmK(r.G,[E]),3);case 3:if(M=W.G)c=M.mainDownloadsLibraryEntity,z=M.mainDownloadsListEntity;case 2:return b=f2c,w={key:g.Id(V.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.ms(n,b,w),g.G(W,ol(r.G,{mode:"readwrite",Wp:!0},function(K){var F=pu(K,e,"ytMainChannelEntity"),l=pu(K,n,"mainVideoDownloadStateEntity"),B=pu(K,N,"mainVideoEntity");F=[F,l,B];r.yH.U("html5_offline_playback_position_sync")&&(l=pu(K,D,"videoPlaybackPositionEntity"),
F.push(l));c&&(l=pu(K,c,"mainDownloadsLibraryEntity"),F.push(l));z&&(l=pu(K,z,"mainDownloadsListEntity"),F.push(l));w&&(K=pu(K,w,"downloadStatusEntity"),F.push(K));return g.t1.all(F)}),4);
case 4:return W.return({mainVideoEntity:N,channelEntity:e})}})},JL_=function(r,V,I){this.G=r;
this.yH=V;this.S=I},Xyp=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k;
return g.L(function(bX){switch(bX.X){case 1:return I=xL(V),d=[],g.G(bX,SV.getInstance(),2);case 2:a=bX.G;if(!a){bX.qk(3);break}return g.G(bX,a.get("sdois"),4);case 4:return f=bX.G,g.G(bX,(n=a)==null?void 0:n.get("lmqf"),5);case 5:e=bX.G;case 3:g.wA(bX,6);if(f===void 0)throw Error("prefStorage or opt-in state is undefined");D=[];if(f){bX.qk(8);break}return g.G(bX,TWf(r.G),9);case 9:D=bX.G,D.reverse();case 8:if(!D.length){bX.qk(10);break}x=g.H(D);E=x.next();case 11:if(E.done){bX.qk(10);break}N=E.value;
if(!N){bX.qk(12);break}c=g.VG(N).entityId;return g.G(bX,K7(r.G,c),14);case 14:return z=bX.G,z.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.G(bX,WK(c,r.G,{entityKey:N,actionType:V.actionType},r.S,z),12);case 12:E=x.next();bX.qk(11);break;case 10:return g.G(bX,X49(f,(M=e)!=null?M:"SD"),16);case 16:return w=bX.G,g.G(bX,z9e(w),17);case 17:b=CP_(w);if(!r.yH.U("woffle_enable_main_downloads_library")){bX.qk(18);break}if(f){bX.qk(19);break}return g.G(bX,bme(r.G,g.Jn),19);case 19:return g.G(bX,
w4P(r.G,[g.Jn]),18);case 18:if((W=b)==null?0:W.length)for(K=g.H(b),F=K.next();!F.done;F=K.next())if(B=l=F.value,P=B.actionType,p=B.entityKey,dA=B.actionMetadata,P&&p&&dA&&!g.U(dA,Z2_)){P==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(dA.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(fg=g.U(l.actionMetadata,oW))fg.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",l.actionMetadata=Object.assign({},l.actionMetadata,{mainVideoEntityActionMetadata:fg});d.push(l)}g.$v(bX,
7);break;case 6:return rA=g.th(bX),ji="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",rA instanceof g.wC&&rA.type==="QUOTA_EXCEEDED"&&(ji="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),bX.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,ji,k));case 7:return bX.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,d))}})},B8m=function(){vK.apply(this,
arguments);
this.V="mainVideoEntity"},gtc=function(r,V,I){V=V===void 0?43200:V;
I=I===void 0?!0:I;var d=d===void 0?!1:d;var a,f,e;return g.L(function(n){switch(n.X){case 1:if(!r.C.hZ())return n.return([]);a=[];g.wA(n,2);return g.G(n,JzG(V,I,d),4);case 4:a=n.G;g.$v(n,3);break;case 2:f=g.th(n),f instanceof Error&&f.message==="No data"||f instanceof Error&&f.message==="Empty response body"&&f7(f.message);case 3:return e=cLm(r,a,I,"mainPlaylistEntity"),n.return(e)}})},Sv9=function(r,V,I,d){d=d===void 0?!1:d;
var a,f,e,n,D,x,E,N,c,z,M,w,b,W,K;return g.L(function(F){switch(F.X){case 1:return a=[],g.G(F,Zme(),2);case 2:return(f=F.G)||d?g.G(F,BWc(V,I),3):F.return([]);case 3:e=F.G;if((n=e)==null||!n.length)return F.return([]);D={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};x=g.H(e);E=x.next();case 4:if(E.done){F.qk(6);break}c=N=E.value;z=c.actionType;M=c.entityKey;w=c.actionMetadata;if(!(z&&M&&w)||g.U(w,Z2_)){F.qk(5);break}z==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(w.offlineLoggingData=
D);b=g.VG(M);W=b.entityId;return g.G(F,qR(r,[W],"mainVideoEntity",z,w),8);case 8:K=F.G,a=a.concat(K);case 5:E=x.next();F.qk(4);break;case 6:return F.return(a)}})},i2e=function(r,V){this.G=r;
this.S=V},QqY=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W;
return g.L(function(K){switch(K.X){case 1:return I=xL(V),d=g.VG(V.entityKey),a=d.entityId,f=[],g.wA(K,2),g.G(K,UX9(r,a),4);case 4:f=K.G;if((e=f)==null||!e.length){K.qk(5);break}return g.G(K,R9G(r.G,V.entityKey),5);case 5:g.$v(K,3);break;case 2:return n=g.th(K),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.wC&&n.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,D,x));case 3:return E=[],g.G(K,e9G(r.G,"musicTrack",f),7);case 7:f=K.G;if(f.length)for(N=g.H(f),c=N.next();!c.done;c=N.next())if(z=c.value,M=z.offlineVideoData,w=void 0,(w=M)==null?0:w.videoId)b=void 0,W=Number(((b=V.actionMetadata)==null?void 0:b.priority)||0)+1,E.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"musicTrack",W,kL,AP(V,M,a)));return K.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,E))}})},
mX6=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp,yZ,Kg,fG,O,ng,qm,Wt,Ao,c9,Br,Jo,G6,t,y,A,Z,Q,Wr,IX,Cg,aX,GS,oX,O_,$r,Jr,vM;
return g.L(function(vt){switch(vt.X){case 1:return I=xL(V),d=V.entityKey,a=g.VG(d).entityId,f=[],e=!1,a==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.G(vt,r0(r.G,"musicAlbumRelease"),5)):g.G(vt,hN(r.G,d,"musicAlbumRelease"),4);case 4:(n=vt.G)&&f.push(n);vt.qk(3);break;case 5:f=vt.G;case 3:if((D=f)==null||!D.length)return vt.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));if(e){x=[];E=g.H(f);for(N=E.next();!N.done;N=E.next())c=N.value,z=g.VG(c.id).entityId,x.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
z,"musicAlbumRelease",0,kL));return vt.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,x))}M=[];w=f[0];b=void 0;if(!w.downloadMetadata){vt.qk(6);break}return g.G(vt,hN(r.G,w.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:W=vt.G,b=Number((F=(K=W)==null?void 0:K.addedTimestampMillis)!=null?F:"0")/1E3;case 6:return g.wA(vt,8),g.G(vt,UX9(r,a,(l=b)==null?void 0:l.toString()),10);case 10:M=vt.G;g.$v(vt,9);break;case 8:B=g.th(vt);if(!(B instanceof Error&&B.message===
"No data")){if(B instanceof Error&&B.message==="Empty response body")f7(B.message);else return P="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",B instanceof g.wC&&B.type==="QUOTA_EXCEEDED"&&(P="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",p="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),vt.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,P,p));vt.qk(9);break}return g.G(vt,tP(a,"musicAlbumRelease",r.G,
V,r.S),9);case 9:dA=[];fg=new Map;if((rA=M)==null?0:rA.length)for(ji=g.H(M),k=ji.next();!k.done;k=ji.next())bX=k.value,RX=bX.offlineVideoData,Ui=void 0,((Ui=RX)==null?0:Ui.videoId)&&fg.set(RX.videoId,RX);$f=new Map;jp=[];if((yZ=w)==null?0:(Kg=yZ.tracks)==null?0:Kg.length)for(fG=g.H(w.tracks),O=fG.next();!O.done;O=fG.next())if(ng=O.value,qm=g.VG(ng).entityId)fg.has(qm)?($f.set(qm,fg.get(qm)),fg.delete(qm)):jp.push(qm);Ao=Number(((Wt=V.actionMetadata)==null?void 0:Wt.priority)||0)+1;c9=g.H(fg.entries());
for(Br=c9.next();!Br.done;Br=c9.next())Jo=Br.value,G6=g.H(Jo),t=G6.next().value,y=G6.next().value,A=t,Z=y,dA.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",A,"musicTrack",Ao,kL,AP(V,Z)));Q=g.H($f.entries());for(Wr=Q.next();!Wr.done;Wr=Q.next())IX=Wr.value,Cg=g.H(IX),aX=Cg.next().value,GS=Cg.next().value,oX=aX,O_=GS,dA.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",oX,"musicTrack",Ao,kL,AP(V,O_)));$r=g.H(jp);for(Jr=$r.next();!Jr.done;Jr=$r.next())vM=Jr.value,dA.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
vM,"musicTrack",0,kL));return vt.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,dA))}})},uFf=function(r,V){var I,d;
return g.L(function(a){switch(a.X){case 1:return I=xL(V),g.wA(a,2),d=g.VG(V.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.G(a,y$(r.G,V,r.S),5):g.G(a,tP(d,"musicAlbumRelease",r.G,V,r.S),6);case 6:return g.G(a,tkm(r.G,V.entityKey),5);case 5:g.$v(a,3);break;case 2:return g.th(a),a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I))}})},UX9=function(r,V,I){var d,a,f;
return g.L(function(e){switch(e.X){case 1:return g.G(e,l2c([V]),2);case 2:return d=e.G,g.G(e,pyG(r,d[0],I),3);case 3:return a=e.G,f=C7(a.thumbnailDetails),g.G(e,O0(f),4);case 4:return e.return(d[0].videos)}})},pyG=function(r,V,I){var d,a,f,e,n,D,x,E,N,c,z,M,w,b;
return g.L(function(W){if(W.X==1){d=V.additionalMetadadatas;a=void 0;if(d&&d.length>0)for(f=g.H(d),e=f.next();!e.done;e=f.next())if(n=e.value,n.offlineMusicPlaylistData){a=n.offlineMusicPlaylistData;break}D=V.playlistId;x=yz6(V);E=x.hk;N=x.Jk;c=I?(Number(I)*1E3).toString():Date.now().toString();z=V.lastModifiedTimestamp?(Number(V.lastModifiedTimestamp)*1E3).toString():"0";M={id:g.Id(D,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:N,lastModifiedTimestampMillis:z,addedTimestampMillis:c,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};w={id:g.Id(D,"musicAlbumRelease"),title:V.title,audioPlaylistId:D,trackCount:V.totalVideoCount,tracks:E,downloadMetadata:M.id};a&&(w.thumbnailDetails=(b=a.albumHqThumbnail)!=null?b:a.albumArtistThumbnail,w.artistDisplayName=a.albumArtistDisplayName,w.releaseDate=a.albumReleaseDate,w.contentRating={explicitType:a.albumReleaseExplicitType},w.releaseType=a.albumReleaseType);return g.G(W,ol(r.G,{mode:"readwrite",Wp:!0},function(K){var F=pu(K,w,"musicAlbumRelease");
K=pu(K,M,"musicAlbumReleaseDownloadMetadataEntity");return g.t1.all([F,K])}),2)}return W.return(w)})},vtG=function(r,V){this.G=r;
this.S=V},P9p=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W;
return g.L(function(K){switch(K.X){case 1:return I=xL(V),d=g.VG(V.entityKey),a=d.entityId,f=[],g.wA(K,2),g.G(K,qvG(r,a),4);case 4:f=K.G;if((e=f)==null||!e.length){K.qk(5);break}return g.G(K,R9G(r.G,V.entityKey),5);case 5:g.$v(K,3);break;case 2:return n=g.th(K),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",n instanceof g.wC&&n.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,D,x));case 3:return E=[],g.G(K,e9G(r.G,"musicTrack",f),7);case 7:f=K.G;if(f.length)for(N=g.H(f),c=N.next();!c.done;c=N.next())if(z=c.value,M=z.offlineVideoData,w=void 0,(w=M)==null?0:w.videoId)b=void 0,W=Number(((b=V.actionMetadata)==null?void 0:b.priority)||0)+1,E.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",M.videoId,"musicTrack",W,hP,AP(V,M,a)));return K.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,E))}})},
otG=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp,yZ,Kg,fG,O,ng,qm,Wt,Ao,c9,Br,Jo,G6,t,y,A,Z,Q,Wr,IX,Cg,aX,GS,oX,O_,$r,Jr,vM,vt,q6,O5,cv,FY,TP,lg,Ue,Qk,tC,e1,PM;
return g.L(function(jS){switch(jS.X){case 1:return I=xL(V),d=V.entityKey,a=g.VG(d).entityId,f=[],e=!1,a==="!*$_ALL_ENTITIES_!*$"?(e=!0,g.G(jS,r0(r.G,"musicPlaylist"),5)):g.G(jS,hN(r.G,d,"musicPlaylist"),4);case 4:(n=jS.G)&&f.push(n);jS.qk(3);break;case 5:f=jS.G;case 3:if((D=f)==null||!D.length)return jS.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));x=g.U(V.actionMetadata,AzK);N=(E=x)==null?void 0:E.autoSync;c=[];M=z=!0;w=!1;b=void 0;if(!e&&N===!1){jS.qk(6);break}g.wA(jS,7);return g.G(jS,
gym(0,!!N,!0,f),9);case 9:c=jS.G;g.$v(jS,8);break;case 7:W=g.th(jS);if(!(W instanceof Error&&W.message==="No data")){W instanceof Error&&W.message==="Empty response body"&&f7(W.message);jS.qk(8);break}return a==="!*$_ALL_ENTITIES_!*$"?g.G(jS,y$(r.G,V,r.S),8):g.G(jS,tP(a,"musicPlaylist",r.G,V,r.S),8);case 8:if(!c.length||!e&&c[0].playlistId!==a)return jS.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));case 6:if(e){K=[];F=g.H(c);for(l=F.next();!l.done;l=F.next())B=l.value,B.upToDate||
N&&!B.shouldAutoSyncMetadata||!B.playlistId||(P={autoSync:N},K.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",B.playlistId,"musicPlaylist",0,hP,{musicPlaylistEntityActionMetadata:P})));return jS.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,K))}c.length&&(p=c[0],w=!!p.upToDate,N&&(z=(dA=p.shouldAutoSyncMetadata)!=null?dA:!0,M=(fg=p.shouldAutoSyncVideos)!=null?fg:!0,p.checkInSeconds&&(b=p.checkInSeconds)));if(w||!z)return jS.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I));rA=[];ji=f[0];k=void 0;if(!ji.downloadMetadata){jS.qk(15);break}return g.G(jS,hN(r.G,ji.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:bX=jS.G,k=Number((Ui=(RX=bX)==null?void 0:RX.addedTimestampMillis)!=null?Ui:"0")/1E3;case 15:return g.wA(jS,17),g.G(jS,qvG(r,a,($f=k)==null?void 0:$f.toString(),b),19);case 19:rA=jS.G;g.$v(jS,18);break;case 17:jp=g.th(jS);if(!(jp instanceof Error&&jp.message==="No data")){if(jp instanceof Error&&jp.message==="Empty response body")f7(jp.message);
else return yZ="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Kg="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",jp instanceof g.wC&&jp.type==="QUOTA_EXCEEDED"&&(yZ="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Kg="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),jS.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,yZ,Kg));jS.qk(18);break}return g.G(jS,tP(a,"musicPlaylist",r.G,V,r.S),18);case 18:if(!M)return jS.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I));fG=[];O=new Map;if((ng=rA)==null?0:ng.length)for(qm=g.H(rA),Wt=qm.next();!Wt.done;Wt=qm.next())Ao=Wt.value,c9=Ao.offlineVideoData,Br=void 0,((Br=c9)==null?0:Br.videoId)&&O.set(c9.videoId,c9);Jo=new Map;G6=[];if((t=ji)==null?0:(y=t.tracks)==null?0:y.length)for(A=g.H(ji.tracks),Z=A.next();!Z.done;Z=A.next())if(Q=Z.value,Wr=g.VG(Q).entityId)O.has(Wr)?(Jo.set(Wr,O.get(Wr)),O.delete(Wr)):G6.push(Wr);Cg=Number(((IX=V.actionMetadata)==null?void 0:IX.priority)||0)+1;aX=g.H(O.entries());for(GS=aX.next();!GS.done;GS=
aX.next())oX=GS.value,O_=g.H(oX),$r=O_.next().value,Jr=O_.next().value,vM=$r,vt=Jr,fG.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",vM,"musicTrack",Cg,hP,AP(V,vt)));q6=g.H(Jo.entries());for(O5=q6.next();!O5.done;O5=q6.next())cv=O5.value,FY=g.H(cv),TP=FY.next().value,lg=FY.next().value,Ue=TP,Qk=lg,fG.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Ue,"musicTrack",Cg,hP,AP(V,Qk)));tC=g.H(G6);for(e1=tC.next();!e1.done;e1=tC.next())PM=e1.value,fG.push(L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
PM,"musicTrack",0,hP));return jS.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,fG))}})},k$6=function(r,V){var I,d;
return g.L(function(a){switch(a.X){case 1:return I=xL(V),g.wA(a,2),d=g.VG(V.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.G(a,y$(r.G,V,r.S),5):g.G(a,tP(d,"musicPlaylist",r.G,V,r.S),6);case 6:return g.G(a,tkm(r.G,V.entityKey),5);case 5:g.$v(a,3);break;case 2:return g.th(a),a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I))}})},qvG=function(r,V,I,d){var a,f,e;
return g.L(function(n){switch(n.X){case 1:return g.G(n,l2c([V]),2);case 2:return a=n.G,g.G(n,h1$(r,a[0],I,d),3);case 3:return f=n.G,e=C7(f.thumbnailDetails),g.G(n,O0(e),4);case 4:return n.return(a[0].videos)}})},h1$=function(r,V,I,d){var a,f,e,n,D,x,E,N,c;
return g.L(function(z){return z.X==1?(a=V.playlistId,f=yz6(V),e=f.hk,n=f.Jk,D=I?(Number(I)*1E3).toString():Date.now().toString(),x=V.lastModifiedTimestamp?(Number(V.lastModifiedTimestamp)*1E3).toString():"0",E={id:g.Id(a,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:n,lastModifiedTimestampMillis:x,addedTimestampMillis:D,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},N={id:g.Id(a,"musicPlaylist"),title:V.title,playlistId:a,thumbnailDetails:V.thumbnail,visibility:rap(V),trackCount:V.totalVideoCount,
tracks:e,downloadMetadata:E.id},d&&(((c=N)==null?0:c.entityMetadata)?N.entityMetadata.nextAutoRefreshIntervalSeconds=String(d):N&&(N.entityMetadata={nextAutoRefreshIntervalSeconds:String(d)})),g.G(z,ol(r.G,{mode:"readwrite",Wp:!0},function(M){var w=pu(M,N,"musicPlaylist");M=pu(M,E,"musicPlaylistDownloadMetadataEntity");return g.t1.all([w,M])}),2)):z.return(N)})},rap=function(r){switch(r.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},VJm=function(r,V){this.G=r;
this.S=V},fJp=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M;
return g.L(function(w){switch(w.X){case 1:return I=xL(V),d=g.VG(V.entityKey),a=d.entityId,f=g.U(V.actionMetadata,IJp),g.wA(w,2),g.G(w,dLo(r,a,void 0,(e=f)==null?void 0:e.track,(n=f)==null?void 0:n.albumRelease),4);case 4:if((D=f)==null?0:D.playlistId){w.qk(5);break}return g.G(w,R9G(r.G,V.entityKey),5);case 5:g.$v(w,3);break;case 2:return x=g.th(w),E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.wC&&x.type==="QUOTA_EXCEEDED"&&
(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),w.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,E,N));case 3:z=Number(((c=V.actionMetadata)==null?void 0:c.priority)||0)+1;var b=(b=g.U(V.actionMetadata,IJp))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;M=L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a,"playbackData",z,aJ_,b);return w.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I,[M]))}})},e8_=function(r,V){var I,d,a,f,e,n,D,x,E,N,c,z,M,w,b;
return g.L(function(W){switch(W.X){case 1:return I=xL(V),d=g.VG(V.entityKey),a=d.entityId,g.G(W,hN(r.G,V.entityKey,"musicTrack"),2);case 2:f=W.G;if(!f){e=void 0;W.qk(3);break}return g.G(W,hN(r.G,f.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:e=W.G;case 3:n=e;if(!f||!n)return W.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I));x=g.U(V.actionMetadata,IJp);g.wA(W,5);return g.G(W,dLo(r,a,n.addedTimestampMillis,(E=x)==null?void 0:E.track,(N=x)==null?void 0:N.albumRelease),
7);case 7:z=Number(((c=V.actionMetadata)==null?void 0:c.priority)||0)+1;D=L7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",a,"playbackData",z,aJ_);g.$v(W,6);break;case 5:M=g.th(W);if(!(M instanceof Error&&M.message==="No data")){if(M instanceof Error&&M.message==="Empty response body")f7(M.message);else return w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",M instanceof g.wC&&M.type==="QUOTA_EXCEEDED"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),W.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,w,b));W.qk(6);break}return g.G(W,RW(a,r.G,V,r.S),6);case 6:return W.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",I,D?[D]:void 0))}})},Yhm=function(r,V){var I,d;
return g.L(function(a){switch(a.X){case 1:return I=xL(V),g.wA(a,2),d=g.VG(V.entityKey).entityId,d==="!*$_ALL_ENTITIES_!*$"?g.G(a,y$(r.G,V,r.S),5):g.G(a,RW(d,r.G,V,r.S),6);case 6:return g.G(a,tkm(r.G,V.entityKey),5);case 5:g.$v(a,3);break;case 2:return g.th(a),a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",I,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return a.return(new JP("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
I))}})},dLo=function(r,V,I,d,a){var f,e,n,D,x,E;
return g.L(function(N){switch(N.X){case 1:if(f=d){N.qk(2);break}return g.G(N,Fe$([V]),3);case 3:e=N.G,n=e[0],f=KeG(n);case 2:return g.G(N,nQ_(r,f,V,a,I),4);case 4:D=N.G;x=D.musicTrackEntity;E=D.gE;var c=C7(x.thumbnailDetails),z=[];E&&(z=C7(E.thumbnailDetails));return g.G(N,O0(c.concat(z)),0)}})},nQ_=function(r,V,I,d,a){var f;
return g.L(function(e){return e.X==1?(a||(a=Date.now().toString()),f={id:g.Id(I,"musicTrackDownloadMetadataEntity"),playbackData:g.Id(I,"playbackData"),addedTimestampMillis:a,videoDownloadContextEntity:g.Id(I,"videoDownloadContextEntity")},d&&(V.albumRelease=d.id),g.G(e,ol(r.G,{mode:"readwrite",Wp:!0},function(n){var D=[],x=pu(n,f,"musicTrackDownloadMetadataEntity");D.push(x);x=pu(n,V,"musicTrack");D.push(x);d&&(n=pu(n,d,"musicAlbumRelease"),D.push(n));return g.t1.all(D)}),2)):e.X!=3?g.G(e,cK(I,"musicTrackDownloadMetadataEntity",
r.G,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):e.return({musicTrackEntity:V,
gE:d})})},rd=function(){vK.apply(this,arguments);
this.V="musicTrack"},j6$=function(r,V,I){V=V===void 0?43200:V;
I=I===void 0?!0:I;var d=d===void 0?!1:d;var a,f;return g.L(function(e){switch(e.X){case 1:if(!r.C.hZ())return e.return([]);a=[];g.wA(e,2);return g.G(e,gym(V,I,d),4);case 4:a=e.G;g.$v(e,3);break;case 2:g.th(e);case 3:return f=cLm(r,a,I,"musicPlaylist"),e.return(f)}})},DL6=function(){g.zu.apply(this,arguments);
var r=this;this.events=new g.Su(this);this.yH=this.player.N();this.m_={xes:function(){return r.G},
C4:function(){return r.C4()},
aP:function(V){return r.aP(V)}}},xLG=function(r){var V;
r=g.U((V=r.getWatchNextResponse())==null?void 0:V.currentVideoEndpoint,g.dt);if(r==null?0:r.playlistId)var I=r.playlistId;return I},EQY=function(r,V){var I,d,a,f;
return g.L(function(e){if(e.X==1){I=V.clientPlaybackNonce;d={cpn:I,offlineSourceVisualElement:g.R9(V.EE||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};V.X&&(d.videoFmt=Number(V.X.itag));V.Y&&(d.audioFmt=Number(V.Y.itag));if((a=xLG(V))&&V.videoId){var n=V.videoId;n=a!=="PPSV"?Promise.resolve(!1):r.G.zq(n);e=g.G(e,n,3)}else e=e.qk(2);return e}e.X!=2&&(f=e.G)&&(d.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");r.X=I;g.N9("offlinePlaybackStarted",d);g.Hr(e)})};
g.Gm.prototype.uO=g.ei(51,function(r){return this.app.uO(r)});
g.Mh.prototype.uO=g.ei(50,function(r){return g.Adi(this,9,r)});
g.T(BO,XZ);g.Yv.Object.defineProperties(BO.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.G.entityMetadata},
set:function(r){this.G.entityMetadata=r}}});
g.T(azG,BO);azG.prototype.X=function(){return[]};
g.T(fzG,BO);fzG.prototype.X=function(){return[]};
g.T(eEm,BO);eEm.prototype.X=function(){return[]};
g.T(Yap,BO);Yap.prototype.X=function(){return[]};
g.T(nIp,BO);nIp.prototype.X=function(){var r=[];this.G.alternateChannel&&r.push(this.G.alternateChannel);this.G.alternateChannelList&&r.push.apply(r,g.R(this.G.alternateChannelList));this.G.oneofChannelEntity&&r.push(this.G.oneofChannelEntity);return[].concat(g.R(new Set(r)))};
g.T(juK,BO);juK.prototype.X=function(){var r=[];this.G.entryCollection&&r.push(this.G.entryCollection);return[].concat(g.R(new Set(r)))};
g.T(Dlp,XZ);Dlp.prototype.X=function(){var r=[];this.G.video&&r.push(this.G.video);return[].concat(g.R(new Set(r)))};
g.T(xlY,BO);xlY.prototype.X=function(){var r=[];this.G.parentPlaylist&&r.push(this.G.parentPlaylist);if(this.G.entries)for(var V=g.H(this.G.entries),I=V.next();!I.done;I=V.next())r.push.apply(r,g.R((new Dlp(I.value)).X()));return[].concat(g.R(new Set(r)))};
g.T(EI_,BO);EI_.prototype.X=function(){var r=[];this.G.descriptionEntity&&r.push(this.G.descriptionEntity);this.G.creators&&r.push.apply(r,g.R(this.G.creators));this.G.theBiggestFan&&r.push(this.G.theBiggestFan);return[].concat(g.R(new Set(r)))};
g.T(Nwc,BO);Nwc.prototype.X=function(){return[]};
g.T(suG,BO);suG.prototype.X=function(){return[]};
g.T(cm6,BO);cm6.prototype.X=function(){return[]};
g.T(zE6,BO);zE6.prototype.X=function(){return[]};
g.T(MDc,BO);MDc.prototype.X=function(){return[]};
g.T(Ck$,BO);Ck$.prototype.X=function(){return[]};
g.T(Twm,BO);Twm.prototype.X=function(){return[]};
g.T(HQ_,BO);HQ_.prototype.X=function(){return[]};
g.T(wY9,BO);wY9.prototype.X=function(){return[]};
g.T(bQm,BO);bQm.prototype.X=function(){var r=[];this.G.downloadsList&&r.push(this.G.downloadsList);this.G.smartDownloadsList&&r.push(this.G.smartDownloadsList);this.G.recommendedDownloadsList&&r.push(this.G.recommendedDownloadsList);this.G.refresh&&r.push(this.G.refresh);return[].concat(g.R(new Set(r)))};
g.T(OQG,XZ);OQG.prototype.X=function(){var r=[];this.G.video&&r.push(this.G.video);this.G.playlist&&r.push(this.G.playlist);this.G.videoItem&&r.push(this.G.videoItem);this.G.playlistItem&&r.push(this.G.playlistItem);return[].concat(g.R(new Set(r)))};
g.T(W0m,BO);W0m.prototype.X=function(){var r=[];this.G.refresh&&r.push(this.G.refresh);if(this.G.downloads)for(var V=g.H(this.G.downloads),I=V.next();!I.done;I=V.next())r.push.apply(r,g.R((new OQG(I.value)).X()));return[].concat(g.R(new Set(r)))};
g.T($lc,BO);$lc.prototype.X=function(){var r=[];this.G.localImageEntities&&r.push.apply(r,g.R(this.G.localImageEntities));return[].concat(g.R(new Set(r)))};
g.T(K0P,BO);K0P.prototype.X=function(){var r=[];this.G.playbackData&&r.push(this.G.playbackData);this.G.localImageEntities&&r.push.apply(r,g.R(this.G.localImageEntities));this.G.videoDownloadContextEntity&&r.push(this.G.videoDownloadContextEntity);return[].concat(g.R(new Set(r)))};
g.T(REo,BO);REo.prototype.X=function(){return[]};
g.T(tDY,BO);tDY.prototype.X=function(){var r=[];this.G.fakeChildren&&r.push.apply(r,g.R(this.G.fakeChildren));return[].concat(g.R(new Set(r)))};
g.T(ymm,BO);ymm.prototype.X=function(){var r=[];this.G.video&&r.push(this.G.video);this.G.playbackData&&r.push(this.G.playbackData);this.G.offlineVideoPolicy&&r.push(this.G.offlineVideoPolicy);return[].concat(g.R(new Set(r)))};
g.T(AmG,BO);AmG.prototype.X=function(){return[]};
g.T(GoY,BO);GoY.prototype.X=function(){var r=[];this.G.channelOwner&&r.push(this.G.channelOwner);this.G.videos&&r.push.apply(r,g.R(this.G.videos));this.G.collaboratorChannels&&r.push.apply(r,g.R(this.G.collaboratorChannels));this.G.downloadState&&r.push(this.G.downloadState);this.G.refresh&&r.push(this.G.refresh);return[].concat(g.R(new Set(r)))};
g.T(F0Y,BO);F0Y.prototype.X=function(){var r=[];this.G.video&&r.push(this.G.video);this.G.channelContributor&&r.push(this.G.channelContributor);return[].concat(g.R(new Set(r)))};
g.T(lz6,XZ);lz6.prototype.X=function(){var r=[];this.G.localImageEntities&&r.push.apply(r,g.R(this.G.localImageEntities));this.G.videoDownloadContextEntity&&r.push(this.G.videoDownloadContextEntity);return[].concat(g.R(new Set(r)))};
g.T(L0o,XZ);L0o.prototype.X=function(){var r=[];this.G.recommendedVideoMetadata&&r.push.apply(r,g.R((new lz6(this.G.recommendedVideoMetadata)).X()));return[].concat(g.R(new Set(r)))};
g.T(Jm$,XZ);Jm$.prototype.X=function(){var r=[];this.G.playbackPosition&&r.push(this.G.playbackPosition);return[].concat(g.R(new Set(r)))};
g.T(ZQG,BO);ZQG.prototype.X=function(){var r=[];this.G.owner&&r.push(this.G.owner);this.G.downloadState&&r.push(this.G.downloadState);this.G.userState&&r.push.apply(r,g.R((new Jm$(this.G.userState)).X()));this.G.additionalMetadata&&r.push.apply(r,g.R((new L0o(this.G.additionalMetadata)).X()));return[].concat(g.R(new Set(r)))};
g.T(XYe,BO);XYe.prototype.X=function(){var r=[];this.G.userChannelDetails&&r.push(this.G.userChannelDetails);return[].concat(g.R(new Set(r)))};
g.T(BwG,BO);BwG.prototype.X=function(){var r=[];this.G.channelOwner&&r.push(this.G.channelOwner);this.G.playbackPosition&&r.push(this.G.playbackPosition);this.G.localImageEntities&&r.push.apply(r,g.R(this.G.localImageEntities));this.G.downloadStatus&&r.push(this.G.downloadStatus);return[].concat(g.R(new Set(r)))};
g.T(gIf,BO);gIf.prototype.X=function(){return[]};
g.T(SaY,BO);SaY.prototype.X=function(){return[]};
g.T(iQf,BO);iQf.prototype.X=function(){return[]};
g.T(UlG,BO);UlG.prototype.X=function(){return[]};
g.T(Quc,BO);Quc.prototype.X=function(){return[]};
g.T(mlm,BO);mlm.prototype.X=function(){return[]};
g.T(upf,BO);upf.prototype.X=function(){return[]};
g.T(pY9,BO);pY9.prototype.X=function(){return[]};
g.T(vI6,BO);vI6.prototype.X=function(){return[]};
g.T(qap,BO);qap.prototype.X=function(){return[]};
g.T(PkG,BO);PkG.prototype.X=function(){return[]};
g.T(oI$,BO);oI$.prototype.X=function(){var r=[];this.G.trackDownloadMetadatas&&r.push.apply(r,g.R(this.G.trackDownloadMetadatas));return[].concat(g.R(new Set(r)))};
g.T(koP,BO);
koP.prototype.X=function(){var r=[];this.G.downloadedTracks&&r.push.apply(r,g.R(this.G.downloadedTracks));this.G.smartDownloadedTracks&&r.push.apply(r,g.R(this.G.smartDownloadedTracks));this.G.downloadedEpisodes&&r.push.apply(r,g.R(this.G.downloadedEpisodes));this.G.downloadedAlbumReleases&&r.push.apply(r,g.R(this.G.downloadedAlbumReleases));this.G.smartDownloadedAlbumReleases&&r.push.apply(r,g.R(this.G.smartDownloadedAlbumReleases));this.G.downloadedPlaylists&&r.push.apply(r,g.R(this.G.downloadedPlaylists));this.G.smartDownloadedPlaylists&&
r.push.apply(r,g.R(this.G.smartDownloadedPlaylists));this.G.metadataOnlyTracks&&r.push.apply(r,g.R(this.G.metadataOnlyTracks));return[].concat(g.R(new Set(r)))};
g.T(hEK,BO);hEK.prototype.X=function(){var r=[];this.G.trackDownloadMetadatas&&r.push.apply(r,g.R(this.G.trackDownloadMetadatas));return[].concat(g.R(new Set(r)))};
g.T(r_c,BO);r_c.prototype.X=function(){var r=[];this.G.playbackData&&r.push(this.G.playbackData);this.G.localImageEntities&&r.push.apply(r,g.R(this.G.localImageEntities));this.G.videoDownloadContextEntity&&r.push(this.G.videoDownloadContextEntity);return[].concat(g.R(new Set(r)))};
g.T(VsG,BO);VsG.prototype.X=function(){var r=[];this.G.musicLibraryStatusEntity&&r.push(this.G.musicLibraryStatusEntity);this.G.primaryArtists&&r.push.apply(r,g.R(this.G.primaryArtists));this.G.details&&r.push(this.G.details);this.G.userDetails&&r.push(this.G.userDetails);this.G.tracks&&r.push.apply(r,g.R(this.G.tracks));this.G.share&&r.push(this.G.share);this.G.downloadMetadata&&r.push(this.G.downloadMetadata);this.G.refresh&&r.push(this.G.refresh);return[].concat(g.R(new Set(r)))};
g.T(Ii6,BO);Ii6.prototype.X=function(){var r=[];this.G.albumRelease&&r.push(this.G.albumRelease);this.G.tracks&&r.push.apply(r,g.R(this.G.tracks));return[].concat(g.R(new Set(r)))};
g.T(d4e,BO);d4e.prototype.X=function(){var r=[];this.G.albumRelease&&r.push(this.G.albumRelease);return[].concat(g.R(new Set(r)))};
g.T(aiY,BO);aiY.prototype.X=function(){var r=[];this.G.details&&r.push(this.G.details);this.G.userDetails&&r.push(this.G.userDetails);return[].concat(g.R(new Set(r)))};
g.T(fi$,BO);fi$.prototype.X=function(){var r=[];this.G.parentArtist&&r.push(this.G.parentArtist);return[].concat(g.R(new Set(r)))};
g.T(eqm,BO);eqm.prototype.X=function(){var r=[];this.G.parentArtist&&r.push(this.G.parentArtist);return[].concat(g.R(new Set(r)))};
g.T(YnY,BO);YnY.prototype.X=function(){return[]};
g.T(niG,BO);niG.prototype.X=function(){return[]};
g.T(j0$,XZ);j0$.prototype.X=function(){var r=[];this.G.creatorEntity&&r.push(this.G.creatorEntity);return[].concat(g.R(new Set(r)))};
g.T(D4o,BO);
D4o.prototype.X=function(){var r=[];this.G.tracks&&r.push.apply(r,g.R(this.G.tracks));this.G.refresh&&r.push(this.G.refresh);this.G.musicLibraryStatusEntity&&r.push(this.G.musicLibraryStatusEntity);this.G.details&&r.push(this.G.details);this.G.downloadMetadata&&r.push(this.G.downloadMetadata);this.G.sideloadMetadata&&r.push(this.G.sideloadMetadata);this.G.userDetails&&r.push(this.G.userDetails);this.G.entryCollection&&r.push(this.G.entryCollection);this.G.share&&r.push(this.G.share);this.G.podcastShowAdditionalMetadata&&r.push.apply(r,
g.R((new j0$(this.G.podcastShowAdditionalMetadata)).X()));return[].concat(g.R(new Set(r)))};
g.T(x4c,BO);x4c.prototype.X=function(){return[]};
g.T(Ei9,BO);
Ei9.prototype.X=function(){var r=[];this.G.musicLibraryStatusEntity&&r.push(this.G.musicLibraryStatusEntity);this.G.artists&&r.push.apply(r,g.R(this.G.artists));this.G.audioModeVersion&&r.push(this.G.audioModeVersion);this.G.videoModeVersion&&r.push(this.G.videoModeVersion);this.G.userDetails&&r.push(this.G.userDetails);this.G.details&&r.push(this.G.details);this.G.albumRelease&&r.push(this.G.albumRelease);this.G.share&&r.push(this.G.share);this.G.libraryEdit&&r.push(this.G.libraryEdit);this.G.downloadMetadata&&
r.push(this.G.downloadMetadata);this.G.playbackPosition&&r.push(this.G.playbackPosition);this.G.lyrics&&r.push(this.G.lyrics);return[].concat(g.R(new Set(r)))};
g.T(NSY,BO);NSY.prototype.X=function(){var r=[];this.G.parentTrack&&r.push(this.G.parentTrack);return[].concat(g.R(new Set(r)))};
g.T(s0P,BO);s0P.prototype.X=function(){var r=[];this.G.parentTrack&&r.push(this.G.parentTrack);return[].concat(g.R(new Set(r)))};
g.T(c_9,BO);c_9.prototype.X=function(){return[]};
g.T(zq_,BO);zq_.prototype.X=function(){return[]};
g.T(MsG,BO);MsG.prototype.X=function(){return[]};
g.T(Coo,BO);Coo.prototype.X=function(){return[]};
g.T(TS_,BO);TS_.prototype.X=function(){var r=[];this.G.transfer&&r.push(this.G.transfer);this.G.adsPlaybackData&&r.push.apply(r,g.R(this.G.adsPlaybackData));this.G.drmLicense&&r.push(this.G.drmLicense);this.G.offlineVideoPolicy&&r.push(this.G.offlineVideoPolicy);this.G.videoDownloadContextEntity&&r.push(this.G.videoDownloadContextEntity);return[].concat(g.R(new Set(r)))};
g.T(HRP,BO);HRP.prototype.X=function(){return[]};
g.T(wu$,BO);wu$.prototype.X=function(){var r=[];this.G.offlineVideoStreams&&r.push.apply(r,g.R(this.G.offlineVideoStreams));this.G.captionTrack&&r.push.apply(r,g.R(this.G.captionTrack));return[].concat(g.R(new Set(r)))};
g.T(bR_,BO);bR_.prototype.X=function(){return[]};
g.T(ORp,BO);ORp.prototype.X=function(){return[]};
g.T(Wxe,BO);Wxe.prototype.X=function(){return[]};
g.T($4m,BO);$4m.prototype.X=function(){return[]};
g.T(Kxp,BO);Kxp.prototype.X=function(){return[]};
g.T(Rqf,BO);Rqf.prototype.X=function(){return[]};
g.T(tsY,BO);tsY.prototype.X=function(){return[]};
g.T(y_P,BO);y_P.prototype.X=function(){return[]};
g.T(A_P,BO);A_P.prototype.X=function(){return[]};
g.T(GO6,BO);GO6.prototype.X=function(){return[]};
g.T(Fxm,BO);Fxm.prototype.X=function(){return[]};
g.T(li9,BO);li9.prototype.X=function(){return[]};
g.T(Lxm,BO);Lxm.prototype.X=function(){return[]};
g.T(J_f,BO);J_f.prototype.X=function(){return[]};
g.T(ZR$,BO);ZR$.prototype.X=function(){return[]};
g.T(Xuc,BO);Xuc.prototype.X=function(){return[]};
g.T(BSm,BO);BSm.prototype.X=function(){return[]};
g.T(giG,BO);giG.prototype.X=function(){return[]};
g.T(Snc,BO);Snc.prototype.X=function(){return[]};
g.T(iR9,BO);iR9.prototype.X=function(){return[]};
var SKG=["browse","music/browse","unplugged/browse"],uKo=["offline/playlist_sync_check"],G9_=["offline"],imP=["offline/offline_video_playback_position_sync"],QNG=["offline/get_playback_data_entity"],gp;SV.getInstance=function(){return g.L(function(r){return r.return(new Promise(function(V){g.I1().then(function(I){I?(SV.instance||(SV.instance=new SV(I)),V(SV.instance)):V(void 0)})}))})};
SV.prototype.get=function(r){var V=this,I,d,a;return g.L(function(f){if(f.X==1)return g.G(f,usK(V.token),2);if(f.X!=3)return I=f.G,g.G(f,I.get("prefs",r),3);d=f.G;if(!d)return f.return();a=(0,g.m)();return d.expirationTimestampMs<=a?f.return():f.return(d.value)})};
SV.prototype.set=function(r,V,I){I=I===void 0?31536E3:I;var d=this,a,f,e;return g.L(function(n){if(n.X==1)return a=(0,g.m)(),f={key:r,value:V,expirationTimestampMs:a+I*1E3},g.G(n,usK(d.token),2);e=n.G;return g.G(n,g.Xu(e,"prefs",f),0)})};
SV.prototype.remove=function(r){var V=this,I;return g.L(function(d){if(d.X==1)return g.G(d,usK(V.token),2);I=d.G;return g.G(d,I.delete("prefs",r),0)})};
g.T(iu,g.ox);g.T(UE,oi$);UE.prototype.S=function(r,V){V=hqe(V);r=(new TextEncoder).encode(JSON.stringify(r));return this.G.encrypt(r,V)};
UE.prototype.X=function(r,V){if(!(r instanceof Uint8Array))throw puc(1);var I=new TextDecoder;V=hqe(V);r=this.G.decrypt(r,V);return JSON.parse(I.decode(r))};
var r5$={accountLinkStatusEntity:cm6,booleanEntity:eEm,buttonEntity:Lxm,captionTrack:c_9,channelHandle:azG,commerceAcquisitionClientPayloadEntity:ZR$,commerceCartListEntity:Xuc,contextNoteFeedEntityPayload:fzG,continuationTokenEntity:AmG,downloadQualityPickerEntity:Twm,downloadsPageRefreshTokenEntity:wY9,downloadsPageViewConfigurationEntity:gIf,downloadStatusEntity:HQ_,dismissState:tsY,sfvAudioItemCurrentlyPlayingEntity:$4m,emojiFountainDataEntity:Fxm,emojiCustomizationSetEntity:GO6,fakeChannel:nIp,
fakePlaylist:juK,fakePlaylistEntryCollection:xlY,fakeVideo:EI_,fakeVideoDescription:Nwc,featuredProductsEntity:vI6,flowStateEntity:suG,iconBadgeEntity:BSm,interstitialInteractionStateEntity:MDc,likeButtonAnimationEntity:SaY,liveChatPollStateEntity:Ck$,liveViewerLeaderboardChatEntryPointStateEntity:ORp,liveViewerLeaderboardPointsEntity:Wxe,liveReactionsDataEntity:li9,logoEntity:zE6,macroMarkerEntity:iQf,mainDownloadsLibraryEntity:bQm,mainDownloadsListEntity:W0m,mainPlaylistDownloadStateEntity:$lc,
mainPlaylistEntity:GoY,mainPlaylistVideoEntity:F0Y,mainVideoDownloadStateEntity:K0P,mainVideoEntity:ZQG,markersEngagementPanelSyncEntity:UlG,markersVisibilityOverrideEntity:Quc,musicAlbumReleaseDetail:Ii6,musicAlbumReleaseDownloadMetadataEntity:oI$,musicAlbumRelease:VsG,musicAlbumReleaseUserDetail:d4e,musicArtistDetail:fi$,musicArtist:aiY,musicArtistUserDetail:eqm,musicDownloadsLibraryEntity:koP,musicLibraryEdit:YnY,musicLibraryStatusEntity:niG,musicPlaylist:D4o,musicPlaylistDownloadMetadataEntity:hEK,
musicShare:x4c,musicTrackDetail:NSY,musicTrackDownloadMetadataEntity:r_c,musicTrack:Ei9,musicTrackUserDetail:s0P,offlineOrchestrationActionWrapperEntity:zq_,offlineVideoPolicy:MsG,offlineVideoStreams:Coo,offlineabilityEntity:REo,orchestrationWebSamplingEntity:tDY,pageHeaderEntity:y_P,pdpStateEntity:giG,pinnedProductEntity:qap,playbackData:TS_,playerStateEntity:mlm,quantityIncrementerEntity:Snc,refresh:HRP,saveToPlaylistListEntity:Kxp,settingEntity:Rqf,stringEntity:Yap,suggestedFeedbackChipStateEntity:upf,
transfer:wu$,trendingOfferEntity:PkG,videoDownloadContextEntity:bR_,videoOverviewAsyncDataEntity:iR9,videoPlaybackPositionEntity:J_f,votingEntity:A_P,ytMainChannelEntity:XYe,youchatPendingResponseEntity:pY9,ytMainDownloadedVideoEntity:ymm,ytMainVideoEntity:BwG};g.T(qV,oi$);qV.prototype.S=function(r){return r};
qV.prototype.X=function(r){if(r instanceof Uint8Array)throw puc(0);return r};
g.T(PO,g.X);PO.prototype.observe=function(r){var V=this;this.observers.push(r);return function(){var I=V.observers.indexOf(r);I>=0&&V.observers.splice(I,1)}};
PO.prototype.X=function(r){sh9(this,r.data)};
PO.prototype.eC=function(){this.channel.close()};
var TYo,MkY=new g.AL("elementsCommand");var $L=new g.AL("entityBatchUpdate");var f2c=new g.AL("downloadStatusEntity");var wye=new g.AL("mainPlaylistEntityActionMetadata");var oW=new g.AL("mainVideoEntityActionMetadata");var AzK=new g.AL("musicPlaylistEntityActionMetadata");var IJp=new g.AL("musicTrackEntityActionMetadata");var Z2_=new g.AL("localImageEntityActionMetadata");var Zl=new g.AL("playbackDataActionMetadata");var CF9=new g.AL("transferEntityActionMetadata");var dAe=new g.AL("videoPlaybackPositionEntityActionMetadata");var LSm;new g.cA;new g.cA;g0e.prototype.request=function(r,V,I){V=V===void 0?{}:V;return this.locks.request(r,V,function(d){return I(d)})};var aW=g.vr.caches,d0,mFP;IW.prototype.open=function(r){return aW.open(UFe(r))};
IW.prototype.has=function(r){return aW.has(UFe(r))};
IW.prototype.delete=function(r){return aW.delete(UFe(r))};
IW.prototype.match=function(r,V){var I=this,d,a,f,e,n,D;return g.L(function(x){switch(x.X){case 1:return g.G(x,I.keys(),2);case 2:d=x.G,a=g.H(d),f=a.next();case 3:if(f.done){x.qk(5);break}e=f.value;return g.G(x,I.open(e),6);case 6:return n=x.G,g.G(x,n.match(r,V),7);case 7:if(D=x.G)return x.return(D);f=a.next();x.qk(3);break;case 5:return x.return()}})};
g.T(ibp,IW);ibp.prototype.keys=function(){var r,V,I,d,a,f,e,n,D;return g.L(function(x){if(x.X==1)return r=[],V=g.km("CacheStorage keys"),g.G(x,aW.keys(),2);I=x.G;d=g.H(I);for(a=d.next();!a.done;a=d.next()){f=a.value;var E=f.indexOf(":");e=E===-1?{FD:f}:{FD:f.substring(0,E),datasyncId:f.substring(E+1)};n=e.FD;D=e.datasyncId;D===V&&r.push(n)}return x.return(r)})};g.T(eY,g.X);eY.prototype.S=function(r){this.api.Bs("onOfflineOperationFailure",r.data)};
eY.prototype.Y=function(r){this.api.publish("offlinetransferpause",r.data)};
eY.prototype.eC=function(){var r;(r=this.G)==null||r.close();var V;(V=this.X)==null||V.close()};v0m.prototype.r$=function(){this.G&&n7(this)};
v0m.prototype.cF=function(){this.X&&this.X.resolve();this.S=this.G=!1;this.V()};var LT6=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var sN9="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var $c$="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.T(vyY,lJ);vyY.prototype.X=function(r){return E0(r)?oye(this,r):NR(r)?rOe(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};g.T(VN9,lJ);VN9.prototype.X=function(r){return NR(r)?IXm(this,r):a2f(r)?aXG(this,r):s0(r)?fXf(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};g.C=eG$.prototype;g.C.HFs=function(r){var V=this,I,d,a,f;return g.L(function(e){if(!g.v(r.state,128))return e.qk(0);I=r.state.DD;var n=(d=I)==null?void 0:d.errorCode,D=(a=I)==null?void 0:a.QC;f=n==="net.connect"&&D===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(n==null?0:n.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.G(e,V.pk(V.player.getVideoData().videoId,f),0)})};
g.C.pk=function(r,V){var I=this;return g.L(function(d){if(d.X==1){if(I.X)return d.return();I.X=!0;return V==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(g0(I,r,!1,!0),d.qk(0)):g.G(d,BK(I,r),3)}g.JI(r,4);return g.G(d,I.G.pk(V),0)})};
g.C.xL=function(r){r.status===2?(r.status!==this.S&&(Ico(this.G),g.JI(r.videoId,2)),r.qI&&YvG(this.G,r.videoId,r.qI)):r.status===4?(BK(this,r.videoId),this.pk(r.videoId,r.Z1?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):r.status===1&&e1G(this.G);this.S=r.status;this.api.Bs("localmediachange",{videoId:r.videoId,status:r.status})};
g.C.CZ=function(){var r=this,V;return g.L(function(I){if(I.X==1){if(r.X)return I.return();r.X=!0;V=r.player.getVideoData().videoId;return g.G(I,BK(r,V),2)}return g.G(I,r.G.CZ(),0)})};
g.C.wd=function(r){switch(r){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.C.U=function(r){return this.api.N().U(r)};g.T(N3G,lJ);N3G.prototype.X=function(r){return E0(r)?cO_(this,r):NR(r)?zG9(this,r):a2f(r)?MNm(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};OLG.prototype.G=function(r,V){var I=r.action.actionMetadata.priority-V.action.actionMetadata.priority;I===0&&(r.G<V.G?I=-1:r.G>V.G&&(I=1));return I};g.T(SY,g.X);SY.prototype.eC=function(){this.V&&this.V();g.X.prototype.eC.call(this)};
SY.prototype.createAction=function(r,V){var I=g.VG(r.entityKey).entityType,d=g.RM(16);return new T8(I,d,r,V.actionId,V.rootActionId)};
SY.prototype.kc=function(r){var V=this,I,d,a,f,e,n,D,x,E;return g.L(function(N){if(N.X==1){if(V.h0())return N.return();d=(I=r.offlineOrchestrationActionWrapperEntity)!=null?I:new Set;a=[];f=g.H(d);for(e=f.next();!e.done;e=f.next())n=e.value,D=g.VG(n),x=D.entityId,KTm(V.G,x)||a.push(n);return g.G(N,XmG(V,a),2)}E=N.G;return g.G(N,ZLP(V,E),0)})};
SY.prototype.retry=function(){var r=this;return g.L(function(V){return g.G(V,B3$(r),0)})};S8m.prototype.Aa=function(r,V){V=V===void 0?!0:V;var I=this,d,a,f,e,n,D,x,E;return g.L(function(N){switch(N.X){case 1:if(!I.G)return N.return();d=[];a=g.dz(I.G.X,V);f=[];for(e={A8:0};e.A8<a.length;e={A8:e.A8},e.A8++)n=a[e.A8],D=I.G.X4(n,"json3"),x=g.ld(D,{withCredentials:!0,format:"RAW"},3,500).then(function(c){return function(z){z={metadata:g.Hk(a[c.A8]),trackData:z.xhr.responseText};f.push(z)}}(e)).Q7(function(c){f7("Caption fetch error",c)}),d.push(x);
return g.G(N,dl9(d),2);case 2:return g.wA(N,3),g.G(N,RPo(r,f),5);case 5:g.$v(N,0);break;case 3:E=g.th(N),f7("Caption DB transaction error",E),g.Hr(N)}})};g.T(iJ,g.X);iJ.prototype.eC=function(){this.X&&this.X();g.X.prototype.eC.call(this)};
iJ.prototype.S=function(r){var V=this,I,d,a,f,e,n,D,x;return g.L(function(E){d=(I=r.transfer)!=null?I:new Set;a=[];f=g.H(d);for(e=f.next();!e.done;e=f.next())n=e.value,D=g.VG(n),x=D.entityId,a.push(x);return a.length===0?E.return():g.G(E,QsK(V,a),0)})};g.T(q8G,g.X);g.C=q8G.prototype;g.C.eC=function(){this.bL&&this.bL();this.GQ.dispose();this.Y.dispose();this.p8&&g.dS(this.C.IH,this.p8);this.R7&&g.dS(this.C.IH,this.R7);g.X.prototype.eC.call(this)};
g.C.WEk=function(r){var V=this,I,d,a;return g.L(function(f){switch(f.X){case 1:I=g.Id(r,"transfer");if(V.G&&I===V.G.key){g0(V.L,V.W,!0);V.Y.stop();f.qk(0);break}return g.G(f,ol(V.X,{mode:"readwrite",Wp:!0},function(e){return Qp(e,I,"transfer").then(function(n){if(n&&n.transferState!=="TRANSFER_STATE_COMPLETE"&&n.transferState!=="TRANSFER_STATE_FAILED")return n.transferState="TRANSFER_STATE_PAUSED_BY_USER",pu(e,n,"transfer").then(function(){return n})})}),3);
case 3:d=f.G;if(!d){f.qk(0);break}if(!r||!V.S){f.qk(5);break}return g.G(f,cK(r,V.S,V.X,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.G(f,mz(V,r),7);case 7:a=f.G,I29({videoId:r,qT:d,offlineModeType:a}),g.Hr(f)}})};
g.C.CZz=function(){var r=this;if(this.G&&this.W){g0(this.L,this.W,!1);var V=this.G,I=(V==null?0:V.key)?g.VG(V.key).entityId:"";I&&this.S&&(new Promise(function(d,a){cK(I,r.S,r.X,"DOWNLOAD_STATE_PAUSED").catch(function(f){a(f)})})).catch(function(d){f7("Download state setting error",d)})}this.Y.stop()};
g.C.Iy=function(){this.G?ke$(this,this.G):Q$(this)};
g.C.pc=function(r){var V=this;return g.L(function(I){switch(I.X){case 1:if(!V.G){I.qk(2);break}if(V.G.transferState==="TRANSFER_STATE_COMPLETE"||V.G.transferState==="TRANSFER_STATE_FAILED"||!r.transfer||!r.transfer.has(V.G.key)){I.qk(3);break}return g.G(I,hN(V.X,V.G.key,"transfer"),4);case 4:V.G=I.G;if(V.G){I.qk(3);break}return g.G(I,hG_(V),3);case 3:if(V.G)return I.return();case 2:return g.G(I,Q$(V),0)}})};
g.C.pk=function(r,V){var I=this,d,a,f,e,n;return g.L(function(D){switch(D.X){case 1:if(!I.G){uJ(I,"onTransferFailure: "+r);D.qk(2);break}d=I.G;f=((a=d)==null?0:a.key)?g.VG(d.key).entityId:"";a:switch(r){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var x=!1;break a;default:x=!0}return x&&ntf(I)?g.G(D,p7(I,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.G(D,
jq9(I,r),5);case 5:if(!f||!I.S){D.qk(2);break}return g.G(D,cK(f,I.S,I.X,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.G(D,mz(I,f),9);case 9:e=D.G;Dl({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:f,qT:d,offlineModeType:e});if(!f||!I.S){D.qk(2);break}return g.G(D,cK(f,I.S,I.X,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:U0(I),n=Q$(I,!0),V&&V(n),g.Hr(D)}})};
g.C.CZ=function(r){var V=this,I,d,a,f,e,n,D,x,E,N,c,z;return g.L(function(M){switch(M.X){case 1:if(!V.G){uJ(V,"onMaybeTransferStreamsExpired");M.qk(2);break}return ntf(V)?g.G(M,p7(V,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.G(M,jq9(V,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!V.S){M.qk(2);break}I=V.G;a=((d=I)==null?0:d.key)?g.VG(I.key).entityId:"";if(!a){M.qk(2);break}return g.G(M,cK(a,V.S,V.X,"DOWNLOAD_STATE_FAILED"),2);case 9:return V.G||uJ(V,"onMaybeTransferStreamsExpiredRetryAttempting"),
f=V.G,n=((e=f)==null?0:e.key)?g.VG(f.key).entityId:"",g.G(M,mz(V,n),10);case 10:return D=M.G,Dl({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:n,qT:f,offlineModeType:D}),x=ny_(),g.ms(x,Zl,{isEnqueuedForExpiredStreamUrlRefetch:!0}),E=g.Id(n,"playbackData"),N={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:E,actionMetadata:x},c=w0(new T8("playbackData",n,N)),g.G(M,k3(V.X,c,"offlineOrchestrationActionWrapperEntity"),2);case 2:U0(V),z=Q$(V,!0),
r&&r(z),g.Hr(M)}})};
var NBe={},DXf=(NBe.TRANSFER_STATE_TRANSFERRING=1,NBe.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,NBe);g.C=vK.prototype;g.C.nD=function(){return this.W.promise};
g.C.Js=function(){if(this.X&&this.L)return this.W.promise;N89(this).then(this.W.resolve).catch(this.W.reject);return this.W.promise};
g.C.YW=function(r){var V={};return V.playbackData=new vyY(r,this.yH,this.G),V.transfer=new N3G(r,this.yH),V.videoPlaybackPositionEntity=new VN9(r,this.yH),V};
g.C.jM=function(){var r=this;return g.L(function(V){return r.X?g.G(V,PFe(r.X),0):V.qk(0)})};
g.C.TV=function(){var r=this,V,I;return g.L(function(d){if(d.X==1)return r.X||r.L?g.G(d,r.nD(),2):d.return();r.j!==void 0&&(g.bd(r.j),r.j=void 0);r.Y!==void 0&&(g.bd(r.Y),r.Y=void 0);(V=r.X)==null||V.dispose();r.X=void 0;(I=r.L)==null||I.dispose();r.L=void 0;r.api.Bs("onOrchestrationLostLeader");r.W=new g.cA;g.Hr(d)})};
g.C.isOrchestrationLeader=function(){return this.S.G};
g.C.zq=function(){return g.L(function(r){return r.return(!1)})};
g.C.lW=function(r){var V=this.G;V.api.publish("offlinetransferpause",r);var I;(I=V.X)==null||I.postMessage(r)};
g.C.Iy=function(r){var V,I;return g.L(function(d){if(d.X==1)return g.G(d,V$(),2);V=d.G;if(!V)return d.return();I=g.Id(r,"transfer");return g.G(d,ol(V,{mode:"readwrite",Wp:!0},function(a){var f=Qp(a,I,"transfer"),e=Qp(a,g.Id(r,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.t1.all([f,e]).then(function(n){n=g.H(n);var D=n.next().value;var x=n.next().value;return D&&D.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(D.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",pu(a,D,"transfer").then(function(){Dl({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:r,qT:D,offlineModeType:x==null?void 0:x.offlineModeType});return g.t1.resolve(null)})):g.t1.resolve(null)})}),0)})};
g.C.YS=function(r){r=r===void 0?43200:r;var V=this,I,d,a,f,e,n,D,x;return g.L(function(E){if(E.X==1)return V.C.hZ()?g.G(E,V$(),2):E.return(sqp());if(E.X!=3){I=E.G;if(!I)return E.return([]);d=Date.now()/1E3;return g.G(E,r0(I,"offlineVideoPolicy"),3)}a=E.G;f=[];e=g.H(a);for(n=e.next();!n.done;n=e.next())D=n.value,Number(D.lastUpdatedTimestampSeconds)+r<=d&&(x=g.VG(D.key).entityId,f.push(x));return f.length?E.return(qR(V,f,V.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):E.return([])})};
g.C.deleteAll=function(){return qR(this,["!*$_ALL_ENTITIES_!*$"],this.V,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.C.refreshAllStaleEntities=function(r){var V=this;return g.L(function(I){return I.X==1?g.G(I,V.YS(r),2):I.return(I.G)})};
g.C.setUpPositionSyncInterval=function(r){var V=this;this.Y!==void 0&&(g.bd(this.Y),this.Y=void 0);var I=r!=null?r:864E5;this.Y=g.HR(function(){V.Zx(I)},I)};
g.C.Zx=function(r){var V=this,I,d,a,f,e,n;return g.L(function(D){switch(D.X){case 1:return g.wA(D,2),g.G(D,SV.getInstance(),4);case 4:I=D.G;if(!I)throw Error("prefStorage is undefined");return g.G(D,I.get("psi"),5);case 5:d=D.G;f=((a=d)==null?0:a.KD)?Number(d.KD)/1E3:0;e=Date.now();if(!(f+r<=e)){D.qk(6);break}return g.G(D,qR(V,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.$v(D,0);break;case 2:n=g.th(D),f7("Offline manager error",n),
g.Hr(D)}})};
g.C.LK=function(){var r=this,V,I,d,a,f,e,n;return g.L(function(D){if(D.X==1)return g.G(D,V$(),2);if(D.X!=3)return(V=D.G)?g.G(D,r0(V,"transfer"),3):D.return([]);I=D.G;d=[];a=g.H(I);for(f=a.next();!f.done;f=a.next())e=f.value,e.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&e.key&&(n=g.VG(e.key).entityId,d.push(n));return D.return(z1G(r,d))})};
g.C.vI=function(){return g.L(function(r){return r.return([])})};
g.C.Yu=function(){return g.L(function(r){g.Hr(r)})};
g.C.vc=function(){return g.L(function(r){g.Hr(r)})};g.T(MP_,lJ);MP_.prototype.X=function(r){return E0(r)?H2P(this,r):NR(r)?b2o(this,r):s0(r)?O2G(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var PK=[10];g.T(tPp,lJ);tPp.prototype.X=function(r){return E0(r)?G$c(this,r):NR(r)?Fkc(this,r):s0(r)?lcP(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var ALG=[10];g.T(JL_,lJ);JL_.prototype.X=function(r){return NR(r)?Xyp(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};g.T(B8m,vK);g.C=B8m.prototype;g.C.YW=function(r){var V=vK.prototype.YW.call(this,r);V.mainVideoEntity=new tPp(r,this.yH,this.G);V.mainPlaylistEntity=new MP_(r,this.yH,this.G);V.mainDownloadsListEntity=new JL_(r,this.yH,this.G);return V};
g.C.refreshAllStaleEntities=function(r,V){var I=this,d,a,f,e,n,D,x,E,N,c,z;return g.L(function(M){switch(M.X){case 1:d=[];if(!I.yH.U("web_player_offline_playlist_auto_refresh")){M.qk(2);break}return g.G(M,gtc(I,r,V),3);case 3:d=M.G;case 2:return g.G(M,SV.getInstance(),4);case 4:return a=M.G,g.G(M,(f=a)==null?void 0:f.get("sdois"),5);case 5:return e=M.G,g.G(M,(n=a)==null?void 0:n.get("lmqf"),6);case 6:D=M.G;if(!e){M.qk(7);break}E=d;N=E.concat;return g.G(M,Sv9(I,e,(x=D)!=null?x:"SD",r===0),8);case 8:d=
N.call(E,M.G);case 7:return c=d,z=c.concat,g.G(M,vK.prototype.refreshAllStaleEntities.call(I,r,V),9);case 9:return d=z.call(c,M.G),M.return(d)}})};
g.C.zq=function(r){var V,I,d,a,f,e,n,D;return g.L(function(x){if(x.X==1)return g.G(x,V$(),2);if(x.X!=3)return(V=x.G)?g.G(x,hN(V,g.Jn,"mainDownloadsListEntity"),3):x.return(!1);I=x.G;if((d=I)==null?0:(a=d.downloads)==null?0:a.length)for(f=g.Id(r,"mainVideoEntity"),e=g.H(I.downloads),n=e.next();!n.done;n=e.next())if(D=n.value,D.videoItem===f)return x.return(!0);return x.return(!1)})};
g.C.vI=function(){var r=this,V,I,d,a,f,e,n,D;return g.L(function(x){if(x.X==1)return g.G(x,V$(),2);if(x.X!=3)return(V=x.G)?g.G(x,r0(V,"downloadStatusEntity"),3):x.return([]);I=x.G;d=[];a=g.H(I);for(f=a.next();!f.done;f=a.next())e=f.value,e.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&e.key&&(n=g.VG(e.key).entityId,d.push(n));return d.length?(D={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},x.return(qR(r,d,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
D))):x.return([])})};
g.C.vc=function(){var r;return g.L(function(V){return V.X==1?g.G(V,V$(),2):(r=V.G)?g.G(V,ol(r,{mode:"readwrite",Wp:!0},function(I){return m9(I,"mainVideoEntity").then(function(d){var a=[];d=g.H(d);for(var f=d.next();!f.done;f=d.next()){f=f.value;var e=void 0;(e=f.userState)!=null&&e.playbackPosition||(e=g.VG(f.key).entityId,e={key:g.Id(e,"videoPlaybackPositionEntity"),videoId:e,lastPlaybackPositionSeconds:"0"},a.push(pu(I,e,"videoPlaybackPositionEntity")),f.userState={playbackPosition:e.key},a.push(pu(I,
f,"mainVideoEntity")))}return g.t1.all(a)})}),0):V.return()})};
g.C.Yu=function(){var r,V,I,d,a,f,e,n,D,x,E,N,c,z,M,w,b,W,K,F,l,B,P,p,dA,fg,rA,ji,k,bX,RX,Ui,$f,jp,yZ,Kg,fG,O;return g.L(function(ng){if(ng.X==1)return g.G(ng,V$(),2);if(ng.X!=3){r=ng.G;if(!r)return ng.return();V=g.Id("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.G(ng,ol(r,{mode:"readonly",Wp:!0},function(qm){return g.t1.all([Qp(qm,V,"mainDownloadsListEntity"),Qp(qm,g.Jn,"mainDownloadsListEntity"),m9(qm,"mainVideoEntity"),m9(qm,"mainPlaylistEntity")])}),3)}I=ng.G;
d=g.H(I);a=d.next().value;f=d.next().value;e=d.next().value;n=d.next().value;D=a;x=f;E=e;N=n;c=new Set;if((z=D)==null?0:(M=z.downloads)==null?0:M.length)for(w=g.H(D.downloads),b=w.next();!b.done;b=w.next())W=b.value,K=void 0,(F=(K=W.videoItem)!=null?K:W.playlistItem)&&c.add(F);if((l=x)==null?0:(B=l.downloads)==null?0:B.length)for(P=g.H(x.downloads),p=P.next();!p.done;p=P.next())dA=p.value,dA.videoItem&&c.add(dA.videoItem);fg=new Set;rA=[];ji=g.H(N);for(k=ji.next();!k.done;k=ji.next()){bX=k.value;
if(bX.videos)for(RX=g.H(bX.videos),Ui=RX.next();!Ui.done;Ui=RX.next())$f=Ui.value,(jp=JSON.parse(g.VG($f).entityId).videoId)&&fg.add(jp);bX.key&&!c.has(bX.key)&&rA.push(bX.key)}yZ=g.H(E);for(Kg=yZ.next();!Kg.done;Kg=yZ.next())fG=Kg.value,fG.key&&!c.has(fG.key)&&(O=g.VG(fG.key).entityId,fg.has(O)||rA.push(fG.key));return rA.length?g.G(ng,w4P(r,rA),0):ng.qk(0)})};g.T(i2e,lJ);i2e.prototype.X=function(r){return E0(r)?QqY(this,r):NR(r)?mX6(this,r):s0(r)?uFf(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var kL=[10];g.T(vtG,lJ);vtG.prototype.X=function(r){return E0(r)?P9p(this,r):NR(r)?otG(this,r):s0(r)?k$6(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var hP=[10];g.T(VJm,lJ);VJm.prototype.X=function(r){return E0(r)?fJp(this,r):NR(r)?e8_(this,r):s0(r)?Yhm(this,r):Promise.reject(Error("Unsupported action type: "+r.actionType))};
var aJ_=[10];g.T(rd,vK);rd.prototype.YW=function(r){var V=vK.prototype.YW.call(this,r);V.musicTrack=new VJm(r,this.G);V.musicPlaylist=new vtG(r,this.G);V.musicAlbumRelease=new i2e(r,this.G);return V};
rd.prototype.refreshAllStaleEntities=function(r,V){var I=this,d,a,f;return g.L(function(e){if(e.X==1)return g.G(e,j6$(I,r,V),2);if(e.X!=3)return a=d=e.G,f=a.concat,g.G(e,vK.prototype.refreshAllStaleEntities.call(I,r,V),3);d=f.call(a,e.G);return e.return(d)})};g.T(DL6,g.zu);g.C=DL6.prototype;g.C.create=function(){var r=this;g.S(this,this.events);g.VO(this.yH)?this.G=new B8m(this.yH,this.player):g.ih(this.yH)&&(this.G=new rd(this.yH,this.player));this.events.K(this.player,"onPlaybackStartExternal",function(){r.C4()});
this.events.K(this.player,"videodatachange",function(){r.C4()});
this.yH.U("html5_offline_playback_position_sync")&&this.events.K(this.player,"presentingplayerstatechange",this.aP)};
g.C.Gw=function(){return!1};
g.C.Pz=function(r,V,I,d){var a=this;return g.L(function(f){return a.G?f.return(qR(a.G,r,V,I,d)):f.return(Promise.reject())})};
g.C.deleteAll=function(){return this.G.deleteAll()};
g.C.YS=function(r){return this.G.YS(r)};
g.C.refreshAllStaleEntities=function(r){return this.G.refreshAllStaleEntities(r)};
g.C.setUpPositionSyncInterval=function(r){this.G.setUpPositionSyncInterval(r)};
g.C.lW=function(r){this.G.lW(r)};
g.C.Iy=function(r){return this.G.Iy(r)};
g.C.C4=function(){var r=this,V;return g.L(function(I){V=r.player.getVideoData();return g.oa(V)?xLG(V)&&r.X!==V.clientPlaybackNonce?g.G(I,EQY(r,V),0):I.qk(0):I.return()})};
g.C.aP=function(r){var V=this,I,d,a,f,e,n,D;return g.L(function(x){if(x.X==1)return I=V.player.getVideoData(),d=I.TQ,g.TQ(r,2)||g.TQ(r,512)?g.G(x,V$(),2):x.return();if(x.X!=3){a=x.G;if(!a)return f7("PES is undefined"),x.return();f=I.videoId;return g.G(x,hN(a,g.Id(f,"mainVideoEntity"),"mainVideoEntity"),3)}e=x.G;if(!e)return x.return();n=Math.floor(d).toString();D={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:n}};return g.G(x,V.Pz([f],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
D),0)})};
g.C.isOrchestrationLeader=function(){return this.G.isOrchestrationLeader()};
g.C.updateDownloadState=function(r,V){var I,d,a,f;return g.L(function(e){if(e.X==1)return g.G(e,V$(),2);I=e.G;if(!I)return f7("PES is undefined"),e.return();d=g.VG(r);a=d.entityType;f=d.entityId;return g.G(e,cK(f,a,I,V,!0),0)})};g.cD("offline",DL6);})(_yt_player);
